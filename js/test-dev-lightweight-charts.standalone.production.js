/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202212081626
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function s(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(s,i+n),t.lineTo(e,i+n),t.stroke()}function n(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function r(t){if(null===t)throw new Error("Value is null");return t}function l(t){return r(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));const a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function o(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,_=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,f=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function p(t){(t=t.toLowerCase())in a&&(t=a[t]);{const i=f.exec(t)||d.exec(t);if(i)return[o(parseInt(i[1],10)),o(parseInt(i[2],10)),o(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=_.exec(t);if(i)return[o(parseInt(i[1],16)),o(parseInt(i[2],16)),o(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[o(17*parseInt(i[1],16)),o(17*parseInt(i[2],16)),o(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function v(t){const i=p(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class m{constructor(){this.h=[]}subscribe(t,i,s){const e={l:t,o:i,u:!0===s};this.h.push(e)}unsubscribe(t){const i=this.h.findIndex((i=>t===i.l));i>-1&&this.h.splice(i,1)}unsubscribeAll(t){this.h=this.h.filter((i=>i.o!==t))}_(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.l(t,i)))}p(){return this.h.length>0}v(){this.h=[]}}function g(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:g(t[i],s[i]));return t}function b(t){return"number"==typeof t&&isFinite(t)}function w(t){return"number"==typeof t&&t%1==0}function M(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function y(t){const i=t;if(!i||"object"!=typeof i)return i;let s,e,n;for(e in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(e)&&(n=i[e],s[e]=n&&"object"==typeof n?y(n):n);return s}function k(t){return null!==t}function C(t){return null===t?void 0:t}const x="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function T(t,i,s){return void 0===i&&(i=x),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.m={borderSize:1,tickLength:5,fontSize:NaN,font:"",fontFamily:"",color:"",paneBackgroundColor:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.g=t}options(){const t=this.m,i=this.M(),s=this.S();return t.fontSize===i&&t.fontFamily===s||(t.fontSize=i,t.fontFamily=s,t.font=T(i,s),t.paddingTop=2.5/12*i,t.paddingBottom=t.paddingTop,t.paddingInner=i/12*t.tickLength,t.paddingOuter=i/12*t.tickLength,t.baselineOffset=0),t.color=this.k(),t.paneBackgroundColor=this.C(),this.m}k(){return this.g.options().layout.textColor}C(){return this.g.backgroundTopColor()}M(){return this.g.options().layout.fontSize}S(){return this.g.options().layout.fontFamily}}class D{constructor(){this.T=[]}P(t){this.T=t}draw(t,i,s,e){this.T.forEach((n=>{t.save(),n.draw(t,i,s,e),t.restore()}))}}class L{draw(t,i,s,e){t.save(),t.scale(i,i),this.D(t,s,e),t.restore()}drawBackground(t,i,s,e){t.save(),t.scale(i,i),this.L(t,s,e),t.restore()}L(t,i,s){}}class R extends L{constructor(){super(...arguments),this.R=null}A(t){this.R=t}D(t){if(null===this.R||null===this.R.O)return;const i=this.R.O,s=this.R,e=e=>{t.beginPath();for(let n=i.to-1;n>=i.from;--n){const i=s.B[n];t.moveTo(i.x,i.y),t.arc(i.x,i.y,e,0,2*Math.PI)}t.fill()};s.I>0&&(t.fillStyle=s.N,e(s.V+s.I)),t.fillStyle=s.F,e(s.V)}}function E(){return{B:[{x:0,y:0,time:0,price:0}],F:"",N:"",V:0,I:0,O:null}}const A={from:0,to:1};class O{constructor(t,i){this.W=new D,this.j=[],this.H=[],this.$=!0,this.g=t,this.U=i,this.W.P(this.j)}update(t){const i=this.g.serieses();i.length!==this.j.length&&(this.H=i.map(E),this.j=this.H.map((t=>{const i=new R;return i.A(t),i})),this.W.P(this.j)),this.$=!0}renderer(t,i,s){return this.$&&(this.q(t),this.$=!1),this.W}q(t){const i=this.g.serieses(),s=this.U.appliedIndex(),e=this.g.timeScale();i.forEach(((i,n)=>{var h;const l=this.H[n],a=i.markerDataAtIndex(s);if(null===a||!i.visible())return void(l.O=null);const o=r(i.firstValue());l.F=a.backgroundColor,l.V=a.radius,l.I=a.borderWidth,l.B[0].price=a.price,l.B[0].y=i.priceScale().priceToCoordinate(a.price,o.value),l.N=null!==(h=a.borderColor)&&void 0!==h?h:this.g.backgroundColorAtYPercentFromTop(l.B[0].y/t),l.B[0].time=s,l.B[0].x=e.indexToCoordinate(s),l.O=A}))}}class B{constructor(t){this.Y=t}draw(t,i,n,h){if(null===this.Y)return;const r=this.Y.Z.X,l=this.Y.K.X;if(!r&&!l)return;t.save();const a=Math.round(this.Y.G*i),o=Math.round(this.Y.J*i),u=Math.ceil(this.Y.tt*i),c=Math.ceil(this.Y.it*i);t.lineCap="butt",r&&a>=0&&(t.lineWidth=Math.floor(this.Y.Z.I*i),t.strokeStyle=this.Y.Z.st,t.fillStyle=this.Y.Z.st,s(t,this.Y.Z.et),function(t,i,s,e){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(i+n,s),t.lineTo(i+n,e),t.stroke()}(t,a,0,c)),l&&o>=0&&(t.lineWidth=Math.floor(this.Y.K.I*i),t.strokeStyle=this.Y.K.st,t.fillStyle=this.Y.K.st,s(t,this.Y.K.et),e(t,o,0,u)),t.restore()}}class I{constructor(t){this.$=!0,this.nt={Z:{I:1,et:0,st:"",X:!1},K:{I:1,et:0,st:"",X:!1},tt:0,it:0,G:0,J:0},this.ht=new B(this.nt),this.rt=t}lt(){this.$=!0}renderer(t,i){return this.$&&(this.q(),this.$=!1),this.ht}q(){const t=this.rt.visible(),i=r(this.rt.pane()),s=i.model().options().crosshair,e=this.nt;e.K.X=t&&this.rt.horzLineVisible(i),e.Z.X=t&&this.rt.vertLineVisible(),e.K.I=s.horzLine.width,e.K.et=s.horzLine.style,e.K.st=s.horzLine.color,e.Z.I=s.vertLine.width,e.Z.et=s.vertLine.style,e.Z.st=s.vertLine.color,e.tt=i.width(),e.it=i.height(),e.G=this.rt.appliedX(),e.J=this.rt.appliedY()}}function N(t,i,s,e,n,h){t.fillRect(i+h,s,e-2*h,h),t.fillRect(i+h,s+n-h,e-2*h,h),t.fillRect(i,s,h,n),t.fillRect(i+e-h,s,h,n)}function V(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function F(t,i,s,e,n,h){t.save(),t.globalCompositeOperation="copy",t.fillStyle=h,t.fillRect(i,s,e,n),t.restore()}function W(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function z(t,i,s,e,n,h){let r,l,a,o;if(Array.isArray(h))if(2===h.length){const t=Math.max(0,h[0]),i=Math.max(0,h[1]);r=t,l=t,a=i,o=i}else{if(4!==h.length)throw new Error("Wrong border radius - it should be like css border radius");r=Math.max(0,h[0]),l=Math.max(0,h[1]),a=Math.max(0,h[2]),o=Math.max(0,h[3])}else{const t=Math.max(0,h);r=t,l=t,a=t,o=t}t.beginPath(),t.moveTo(i+r,s),t.lineTo(i+e-l,s),0!==l&&t.arcTo(i+e,s,i+e,s+l,l),t.lineTo(i+e,s+n-a),0!==a&&t.arcTo(i+e,s+n,i+e-a,s+n,a),t.lineTo(i+o,s+n),0!==o&&t.arcTo(i,s+n,i,s+n-o,o),t.lineTo(i,s+r),0!==r&&t.arcTo(i,s,i+r,s,r)}function j(t,i,s,e,n,h,r=0,l=0,a=""){if(t.save(),!r||!a||a===h)return z(t,i,s,e,n,l),t.fillStyle=h,t.fill(),void t.restore();const o=r/2;if("transparent"!==h){z(t,i+r,s+r,e-2*r,n-2*r,W(l,-r)),t.fillStyle=h,t.fill()}if("transparent"!==a){z(t,i+o,s+o,e-r,n-r,W(l,-o)),t.lineWidth=r,t.strokeStyle=a,t.closePath(),t.stroke()}}function H(t,i,s,e,n,h,r){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,n);l.addColorStop(0,h),l.addColorStop(1,r),t.fillStyle=l,t.fillRect(i,s,e,n),t.restore()}class ${constructor(t,i){this.setData(t,i)}setData(t,i){this.Y=t,this.ot=i}draw(t,i,s,e,n,h){if(!this.Y.visible)return;t.font=i.font;const r=this.ut(t,i,s,e,n,h),l=this.Y.color||this.ot.color,a=this.ot.background;if(t.fillStyle=this.ot.background,this.Y.text){const s=(i,s)=>{r.ct?j(t,r._t,r.dt,r.ft,r.vt,i,r.gt,[r.V,0,0,r.V],s):j(t,r.bt,r.dt,r.ft,r.vt,i,r.gt,[0,r.V,r.V,0],s)};s(a,"transparent"),this.Y.tickVisible&&(t.fillStyle=l,t.fillRect(r.bt,r.wt,r.Mt-r.bt,r.St)),s("transparent",a),this.Y.borderVisible&&(t.fillStyle=i.paneBackgroundColor,t.fillRect(r.ct?r.yt-r.gt:0,r.dt,r.gt,r.kt-r.dt)),t.save(),t.translate(r.Ct,(r.dt+r.kt)/2+r.xt),V(t,h,(()=>{t.fillStyle=l,t.fillText(this.Y.text,0,0)})),t.restore()}}height(t,i){return this.Y.visible?t.fontSize+t.paddingTop+t.paddingBottom:0}ut(t,i,s,e,n,h){const r=this.Y.tickVisible||!this.Y.moveTextToInvisibleTick?i.tickLength:0,l=i.borderSize,a=i.paddingTop+this.ot.additionalPaddingTop,o=i.paddingBottom+this.ot.additionalPaddingBottom,u=i.paddingInner,c=i.paddingOuter,_=this.Y.text,d=i.fontSize,f=s.yMidCorrection(t,_)*h,p=d+a+o,v=l+u+c+Math.ceil(s.measureText(t,_))+r,m=Math.max(1,Math.floor(h));let g=Math.round(p*h);g%2!=m%2&&(g+=1);const b=this.Y.separatorVisible?Math.max(1,Math.floor(l*h)):0,w=Math.round(v*h),M=Math.round(r*h),S=Math.ceil(e*h),y=Math.ceil(u*h);let k=this.ot.coordinate;this.ot.fixedCoordinate&&(k=this.ot.fixedCoordinate),k=Math.round(k*h)-Math.floor(.5*h);const C=Math.floor(k+m/2-g/2),x=C+g,T="right"===n,P=T?S-b:b,D=S;let L,R,E=P;const A=2*h;return t.textAlign=T?"right":"left",t.textBaseline="middle",T?(E=P-w,L=P-M,R=P-M-y-1):(E=P+w,L=P+M,R=P+M+y),{ct:T,dt:C,wt:k,kt:x,ft:w,vt:g,V:A,gt:b,_t:E,bt:P,Mt:L,Ct:R,St:m,yt:D,xt:f}}}class U{constructor(t){this.Tt={coordinate:0,color:"#FFF",background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this.Pt={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:"",color:"#FFF",borderVisible:!1,separatorVisible:!1},this.Dt={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:"",color:"#FFF",borderVisible:!0,separatorVisible:!0},this.$=!0,this.Lt=new(t||$)(this.Pt,this.Tt),this.Rt=new(t||$)(this.Dt,this.Tt)}text(){return this.Et(),this.Pt.text}coordinate(){return this.Et(),this.Tt.coordinate}update(){this.$=!0}height(t,i=!1){return Math.max(this.Lt.height(t,i),this.Rt.height(t,i))}getFixedCoordinate(){return this.Tt.fixedCoordinate||0}setFixedCoordinate(t){this.Tt.fixedCoordinate=t}isVisible(){return this.Et(),this.Pt.visible||this.Dt.visible}isAxisLabelVisible(){return this.Et(),this.Pt.visible}renderer(t){return this.Et(),this.Pt.tickVisible=this.Pt.tickVisible&&t.options().ticksVisible,this.Dt.tickVisible=this.Dt.tickVisible&&t.options().ticksVisible,this.Lt.setData(this.Pt,this.Tt),this.Rt.setData(this.Dt,this.Tt),this.Lt}paneRenderer(){return this.Et(),this.Lt.setData(this.Pt,this.Tt),this.Rt.setData(this.Dt,this.Tt),this.Rt}Et(){this.$&&(this.Pt.tickVisible=!0,this.Dt.tickVisible=!1,this.At(this.Pt,this.Dt,this.Tt))}}class q extends U{constructor(t,i,s){super(),this.rt=t,this.Ot=i,this.Bt=s}At(t,i,s){t.visible=!1;const e=this.rt.options().horzLine;if(!e.labelVisible)return;const n=this.Ot.firstValue();if(!this.rt.visible()||this.Ot.isEmpty()||null===n)return;const h=v(e.labelBackgroundColor);s.background=h.t,s.color=h.i;const r=2/12*this.Ot.fontSize();s.additionalPaddingTop=r,s.additionalPaddingBottom=r;const l=this.Bt(this.Ot);s.coordinate=l.It,t.text=this.Ot.formatPrice(l.Nt,n),t.visible=!0}}const Y=/[1-9]/g;class X{constructor(){this.Y=null}setData(t){this.Y=t}draw(t,i,s){if(null===this.Y||!1===this.Y.visible||0===this.Y.text.length)return;t.font=i.font;const e=Math.round(i.widthCache.measureText(t,this.Y.text,Y));if(e<=0)return;t.save();const n=i.paddingHorizontal,h=e+2*n,l=h/2,a=this.Y.width;let o=this.Y.coordinate,u=Math.floor(o-l)+.5;u<0?(o+=Math.abs(0-u),u=Math.floor(o-l)+.5):u+h>a&&(o-=Math.abs(a-(u+h)),u=Math.floor(o-l)+.5);const c=u+h,_=Math.ceil(0+i.borderSize+i.tickLength+i.paddingTop+i.fontSize+i.paddingBottom);t.fillStyle=this.Y.background;const d=Math.round(u*s),f=Math.round(0*s),p=Math.round(c*s),v=Math.round(_*s),m=Math.round(2*s);if(t.beginPath(),t.moveTo(d,f),t.lineTo(d,v-m),t.arcTo(d,v,d+m,v,m),t.lineTo(p-m,v),t.arcTo(p,v,p,v-m,m),t.lineTo(p,f),t.fill(),this.Y.tickVisible){const e=Math.round(this.Y.coordinate*s),n=f,h=Math.round((n+i.tickLength)*s);t.fillStyle=this.Y.color;const r=Math.max(1,Math.floor(s)),l=Math.floor(.5*s);t.fillRect(e-l,n,r,h-n)}const g=0+i.borderSize+i.tickLength+i.paddingTop+i.fontSize/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.Y.color;const b=i.widthCache.yMidCorrection(t,"Apr0");t.translate((u+n)*s,(g+b)*s),V(t,s,(()=>t.fillText(r(this.Y).text,0,0))),t.restore()}}class Z{constructor(t,i,s){this.$=!0,this.ht=new X,this.nt={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN,tickVisible:!0},this.U=t,this.Vt=i,this.Bt=s}lt(){this.$=!0}renderer(){return this.$&&(this.q(),this.$=!1),this.ht.setData(this.nt),this.ht}q(){const t=this.nt;t.visible=!1;const i=this.U.options().vertLine;if(!i.labelVisible)return;const s=this.Vt.timeScale();if(s.isEmpty())return;t.width=s.width();const e=this.Bt();if(!e.Ft)return;t.coordinate=e.It;const n=s.indexToTimeScalePoint(this.U.appliedIndex());t.text=s.formatDateTime(r(n)),t.visible=!0;const h=v(i.labelBackgroundColor);t.background=h.t,t.color=h.i,t.tickVisible=s.options().ticksVisible}}class K{constructor(){this._priceScale=null,this.Wt=0}zorder(){return this.Wt}setZorder(t){this.Wt=t}priceScale(){return this._priceScale}setPriceScale(t){this._priceScale=t}labelPaneViews(t){return[]}timeAxisViews(){return[]}visible(){return!0}}var G;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(G||(G={}));class J extends K{constructor(t,i){super(),this.zt=null,this.jt=NaN,this.Ht=0,this.$t=!0,this.Ut=new Map,this.qt=!1,this.Yt=NaN,this.Xt=NaN,this.Zt=NaN,this.Kt=NaN,this.Vt=t,this.Gt=i,this.Jt=new O(t,this);this.Qt=((t,i)=>s=>{const e=i(),n=t();if(s===r(this.zt).defaultPriceScale())return{Nt:n,It:e};{const t=r(s.firstValue());return{Nt:s.coordinateToPrice(e,t),It:e}}})((()=>this.jt),(()=>this.Xt));const s=((t,i)=>()=>({Ft:this.Vt.timeScale().indexToTime(t()),It:i()}))((()=>this.Ht),(()=>this.appliedX()));this.ti=new Z(this,t,s),this.ii=new I(this)}options(){return this.Gt}saveOriginCoord(t,i){this.Zt=t,this.Kt=i}clearOriginCoord(){this.Zt=NaN,this.Kt=NaN}originCoordX(){return this.Zt}originCoordY(){return this.Kt}setPosition(t,i,s){this.qt||(this.qt=!0),this.$t=!0,this.si(t,i,s)}appliedIndex(){return this.Ht}appliedX(){return this.Yt}appliedY(){return this.Xt}visible(){return this.$t}clearPosition(){this.$t=!1,this.ei(),this.jt=NaN,this.Yt=NaN,this.Xt=NaN,this.zt=null,this.clearOriginCoord()}paneViews(t){return null!==this.zt?[this.ii,this.Jt]:[]}horzLineVisible(t){return t===this.zt&&this.Gt.horzLine.visible}vertLineVisible(){return this.Gt.vertLine.visible}priceAxisViews(t,i){this.$t&&this.zt===t||this.Ut.clear();const s=[];return this.zt===t&&s.push(this.ni(this.Ut,i,this.Qt)),s}timeAxisViews(){return this.$t?[this.ti]:[]}pane(){return this.zt}updateAllViews(){this.ii.lt(),this.Ut.forEach((t=>t.update())),this.ti.lt(),this.Jt.update()}hi(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null}si(t,i,s){this.ri(t,i,s)&&this.updateAllViews()}ri(t,i,s){const e=this.Yt,n=this.Xt,h=this.jt,r=this.Ht,l=this.zt,a=this.hi(s);this.Ht=t,this.Yt=isNaN(t)?NaN:this.Vt.timeScale().indexToCoordinate(t),this.zt=s;const o=null!==a?a.firstValue():null;return null!==a&&null!==o?(this.jt=i,this.Xt=a.priceToCoordinate(i,o)):(this.jt=NaN,this.Xt=NaN),e!==this.Yt||n!==this.Xt||r!==this.Ht||h!==this.jt||l!==this.zt}ei(){const t=this.Vt.serieses().map((t=>t.bars().lastIndex())).filter(k),i=0===t.length?null:Math.max(...t);this.Ht=null!==i?i:NaN}ni(t,i,s){let e=t.get(i);return void 0===e&&(e=new q(this,i,s),t.set(i,e)),e}}function Q(t){return"left"===t||"right"===t}class tt{constructor(t){this.li=new Map,this.ai=[],this.oi=t}invalidatePane(t,i){const s=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.li.get(t),i);this.li.set(t,s)}fullInvalidation(){return this.oi}invalidateForPane(t){const i=this.li.get(t);return void 0===i?{level:this.oi}:{level:Math.max(this.oi,i.level),autoScale:i.autoScale}}setFitContent(){this.stopTimeScaleAnimation(),this.ai=[{type:0}]}applyRange(t){this.stopTimeScaleAnimation(),this.ai=[{type:1,value:t}]}setTimeScaleAnimation(t){this.ui(),this.ai.push({type:5,value:t})}stopTimeScaleAnimation(){this.ui(),this.ai.push({type:6})}resetTimeScale(){this.stopTimeScaleAnimation(),this.ai=[{type:4}]}setBarSpacing(t){this.stopTimeScaleAnimation(),this.ai.push({type:2,value:t})}setRightOffset(t){this.stopTimeScaleAnimation(),this.ai.push({type:3,value:t})}timeScaleInvalidations(){return this.ai}merge(t){for(const i of t.ai)this.ci(i);this.oi=Math.max(this.oi,t.oi),t.li.forEach(((t,i)=>{this.invalidatePane(i,t)}))}static light(){return new tt(2)}static full(){return new tt(3)}ci(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale();break;case 5:this.setTimeScaleAnimation(t.value);break;case 6:this.ui()}}ui(){const t=this.ai.findIndex((t=>5===t.type));-1!==t&&this.ai.splice(t,1)}}const it=".";function st(t,i){if(!b(t))return"n/a";if(!w(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class et{constructor(t,i){if(i||(i=1),b(t)&&w(t)||(t=100),t<0)throw new TypeError("invalid base");this.Ot=t,this._i=i,this.di()}format(t){const i=t<0?"âˆ’":"";return t=Math.abs(t),i+this.fi(t)}di(){if(this.pi=0,this.Ot>0&&this._i>0){let t=this.Ot;for(;t>1;)t/=10,this.pi++}}fi(t){const i=this.Ot/this._i;let s=Math.floor(t),e="";const n=void 0!==this.pi?this.pi:NaN;if(i>1){let h=+(Math.round(t*i)-s*i).toFixed(this.pi);h>=i&&(h-=i,s+=1),e=it+st(+h.toFixed(this.pi)*this._i,n)}else s=Math.round(s*i)/i,n>0&&(e=it+st(0,n));return s.toFixed(0)+e}}class nt extends et{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class ht{constructor(t){this.vi=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.mi(t):t<999995?i+this.mi(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.mi(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.mi(t/1e9)+"B")}mi(t){let i;const s=Math.pow(10,this.vi);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.vi).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function rt(t,i,s,e,n,h,r){if(0===i.length||e.from>=i.length)return;const l=i[e.from];let a=h(t,l),o=l;if(e.to-e.from<2){const i=n/2;t.beginPath();const s={G:l.G-i,J:l.J},e={G:l.G+i,J:l.J};return t.moveTo(s.G,s.J),t.lineTo(e.G,e.J),void r(t,a,s,e)}const u=(i,s)=>{r(t,a,o,s),t.beginPath(),a=i,o=s};let c=o;t.beginPath(),t.moveTo(l.G,l.J);for(let n=e.from+1;n<e.to;++n){c=i[n];const e=h(t,c);switch(s){case 0:t.lineTo(c.G,c.J);break;case 1:t.lineTo(c.G,i[n-1].J),e!==a&&(u(e,c),t.lineTo(c.G,i[n-1].J)),t.lineTo(c.G,c.J);break;case 2:{const[s,e]=ot(i,n-1,n);t.bezierCurveTo(s.G,s.J,e.G,e.J,c.G,c.J);break}}1!==s&&e!==a&&(u(e,c),t.moveTo(c.G,c.J))}(o!==c||o===c&&1===s)&&r(t,a,o,c)}function lt(t,i){return{G:t.G-i.G,J:t.J-i.J}}function at(t,i){return{G:t.G/i,J:t.J/i}}function ot(t,i,s){const e=Math.max(0,i-1),n=Math.min(t.length-1,s+1);var h,r;return[(h=t[i],r=at(lt(t[s],t[e]),6),{G:h.G+r.G,J:h.J+r.J}),lt(t[s],at(lt(t[n],t[i]),6))]}function ut(t,i,s,e,n){i.lineTo(n.G,t),i.lineTo(e.G,t),i.closePath(),i.fillStyle=s,i.fill()}class ct extends L{constructor(){super(...arguments),this.R=null}A(t){this.R=t}D(t){if(null===this.R)return;const{B:i,O:e,gi:n,I:h,et:r,bi:l,wi:a}=this.R;null!==e&&(t.lineCap="butt",t.lineJoin="round",t.lineWidth=h,s(t,r),t.lineWidth=1,rt(t,i,l,e,n,this.Mi.bind(this),ut.bind(null,a)))}}class _t extends ct{constructor(){super(...arguments),this.Si=null}Mi(t,i){const s=this.R,{topColor:e,bottomColor:n}=i,h=s.yi;if(null!==this.Si&&this.Si.topColor===e&&this.Si.bottomColor===n&&this.Si.bottom===h)return this.Si.fillStyle;const r=t.createLinearGradient(0,0,0,h);return r.addColorStop(0,e),r.addColorStop(1,n),this.Si={topColor:e,bottomColor:n,fillStyle:r,bottom:h},r}}function dt(t,i){t.strokeStyle=i,t.stroke()}class ft extends L{constructor(){super(...arguments),this.R=null}A(t){this.R=t}D(t){if(null===this.R)return;const{B:i,O:e,gi:n,bi:h,I:r,et:l}=this.R;null!==e&&(t.lineCap="butt",t.lineWidth=r,s(t,l),t.lineJoin="round",rt(t,i,h,e,n,this.ki.bind(this),dt))}}class pt extends ft{ki(t,i){return i.lineColor}}function vt(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,r=e+n;s(t[r],i)?(e=r+1,h-=n+1):h=n}return e}function mt(t,i,s,e=0,n=t.length){let h=n-e;for(;0<h;){const n=h>>1,r=e+n;s(i,t[r])?h=n:(e=r+1,h-=n+1)}return e}function gt(t,i){return t.time<i}function bt(t,i){return t<i.time}function wt(t,i,s){const e=i.left(),n=i.right(),h=vt(t,e,gt),r=mt(t,n,bt);if(!s)return{from:h,to:r};let l=h,a=r;return h>0&&h<t.length&&t[h].time>=e&&(l=h-1),r>0&&r<t.length&&t[r-1].time<=n&&(a=r+1),{from:l,to:a}}class Mt{constructor(t,i,s){this.Ci=!0,this.xi=!0,this.Ti=!0,this.Pi=[],this.Di=null,this.Li=t,this.Ri=i,this.Ei=s}update(t){this.Ci=!0,"data"===t&&(this.xi=!0),"options"===t&&(this.Ti=!0)}renderer(t,i){return this.Li.visible()?(this.Ai(i,t),null===this.Di?null:this.Oi):null}Bi(){this.Pi=this.Pi.map((t=>Object.assign(Object.assign({},t),this.Li.barColorer().barStyle(t.time))))}Ii(){this.Di=null}Ai(t,i){this.xi&&(this.Ni(),this.xi=!1),this.Ti&&(this.Bi(),this.Ti=!1),this.Ci&&(this.Vi(t,i),this.Ci=!1)}Vi(t,i){const s=this.Li.priceScale(),e=this.Ri.timeScale();if(this.Ii(),e.isEmpty()||s.isEmpty())return;const n=e.visibleStrictRange();if(null===n)return;if(0===this.Li.bars().size())return;const h=this.Li.firstValue();null!==h&&(this.Di=wt(this.Pi,n,this.Ei),this.Fi(s,e,h.value),this.Wi(t,i))}}class St extends Mt{constructor(t,i){super(t,i,!0)}Fi(t,i,s){i.indexesToCoordinates(this.Pi,C(this.Di)),t.pointsArrayToCoordinates(this.Pi,s,C(this.Di))}zi(t,i){return{time:t,price:i,x:NaN,y:NaN}}Ni(){const t=this.Li.barColorer();this.Pi=this.Li.bars().rows().map((i=>{const s=i.value[3];return this.ji(i.index,s,t)}))}}class yt extends St{constructor(t,i){super(t,i),this.Oi=new D,this.Hi=new _t,this.$i=new pt,this.Oi.P([this.Hi,this.$i])}ji(t,i,s){return Object.assign(Object.assign({},this.zi(t,i)),s.barStyle(t))}Wi(t,i){const s=this.Li.options(),e=s.invertFilledArea?0:i;this.Hi.A({bi:s.lineType,B:this.Pi,et:s.lineStyle,I:s.lineWidth,wi:e,yi:i,O:this.Di,gi:this.Ri.timeScale().barSpacing()}),this.$i.A({bi:s.lineType,B:this.Pi,et:s.lineStyle,I:s.lineWidth,O:this.Di,gi:this.Ri.timeScale().barSpacing()})}}class kt{constructor(){this.Y=null,this.Ui=0,this.qi=0}A(t){this.Y=t}draw(t,i,s,e){if(null===this.Y||0===this.Y.Yi.length||null===this.Y.O)return;if(this.Ui=this.Xi(i),this.Ui>=2){Math.max(1,Math.floor(i))%2!=this.Ui%2&&this.Ui--}this.qi=this.Y.Zi?Math.min(this.Ui,Math.floor(i)):this.Ui;let n=null;const h=this.qi<=this.Ui&&this.Y.Ki>=Math.floor(1.5*i);for(let s=this.Y.O.from;s<this.Y.O.to;++s){const e=this.Y.Yi[s];n!==e.barColor&&(t.fillStyle=e.barColor,n=e.barColor);const r=Math.floor(.5*this.qi),l=Math.round(e.x*i),a=l-r,o=this.qi,u=a+o-1,c=Math.min(e.highY,e.lowY),_=Math.max(e.highY,e.lowY),d=Math.round(c*i)-r,f=Math.round(_*i)+r,p=Math.max(f-d,this.qi);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.Ui);if(h){if(this.Y.Gi){const s=l-v;let n=Math.max(d,Math.round(e.openY*i)-r),h=n+o-1;h>d+p-1&&(h=d+p-1,n=h-o+1),t.fillRect(s,n,a-s,h-n+1)}const s=l+v;let n=Math.max(d,Math.round(e.closeY*i)-r),h=n+o-1;h>d+p-1&&(h=d+p-1,n=h-o+1),t.fillRect(u+1,n,s-u,h-n+1)}}}Xi(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(r(this.Y).Ki,t)))}}class Ct extends Mt{constructor(t,i){super(t,i,!1)}Fi(t,i,s){i.indexesToCoordinates(this.Pi,C(this.Di)),t.barPricesToCoordinates(this.Pi,s,C(this.Di))}Ji(t,i,s){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}}Ni(){const t=this.Li.barColorer();this.Pi=this.Li.bars().rows().map((i=>this.ji(i.index,i,t)))}}class xt extends Ct{constructor(){super(...arguments),this.Oi=new kt}ji(t,i,s){return Object.assign(Object.assign({},this.Ji(t,i,s)),s.barStyle(t))}Wi(){const t=this.Li.options();this.Oi.A({Yi:this.Pi,Ki:this.Ri.timeScale().barSpacing(),Gi:t.openVisible,Zi:t.thinBars,O:this.Di})}}function Tt(t,i,s){return Math.min(Math.max(t,i),s)}function Pt(t,i,s){return i-t<=s}function Dt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Lt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Rt extends ct{constructor(){super(...arguments),this.Si=null}Mi(t,i){const s=this.R,{topFillColor1:e,topFillColor2:n,bottomFillColor1:h,bottomFillColor2:r}=i,{wi:l,yi:a}=s;if(null!==this.Si&&this.Si.topFillColor1===e&&this.Si.topFillColor2===n&&this.Si.bottomFillColor1===h&&this.Si.bottomFillColor2===r&&this.Si.baseLevelCoordinate===l&&this.Si.bottom===a)return this.Si.fillStyle;const o=t.createLinearGradient(0,0,0,a),u=Tt(l/a,0,1);return o.addColorStop(0,e),o.addColorStop(u,n),o.addColorStop(u,h),o.addColorStop(1,r),this.Si={topFillColor1:e,topFillColor2:n,bottomFillColor1:h,bottomFillColor2:r,fillStyle:o,baseLevelCoordinate:l,bottom:a},o}}class Et extends ft{constructor(){super(...arguments),this.Qi=null}ki(t,i){const s=this.R,{topLineColor:e,bottomLineColor:n}=i,{wi:h,yi:r}=s;if(null!==this.Qi&&this.Qi.topLineColor===e&&this.Qi.bottomLineColor===n&&this.Qi.baseLevelCoordinate===h&&this.Qi.bottom===r)return this.Qi.strokeStyle;const l=t.createLinearGradient(0,0,0,r),a=Tt(h/r,0,1);return l.addColorStop(0,e),l.addColorStop(a,e),l.addColorStop(a,n),l.addColorStop(1,n),this.Qi={topLineColor:e,bottomLineColor:n,strokeStyle:l,baseLevelCoordinate:h,bottom:r},l}}class At extends St{constructor(t,i){super(t,i),this.Oi=new D,this.ts=new Rt,this.ss=new Et,this.Oi.P([this.ts,this.ss])}ji(t,i,s){return Object.assign(Object.assign({},this.zi(t,i)),s.barStyle(t))}Wi(t,i){const s=this.Li.firstValue();if(null===s)return;const e=this.Li.options(),n=this.Li.priceScale().priceToCoordinate(e.baseValue.price,s.value),h=this.Ri.timeScale().barSpacing();this.ts.A({B:this.Pi,I:e.lineWidth,et:e.lineStyle,bi:e.lineType,wi:n,yi:i,O:this.Di,gi:h}),this.ss.A({B:this.Pi,I:e.lineWidth,et:e.lineStyle,bi:e.lineType,wi:n,yi:i,O:this.Di,gi:h})}}class Ot{constructor(){this.Y=null,this.Ui=0}A(t){this.Y=t}draw(t,i,s,e){if(null===this.Y||0===this.Y.Yi.length||null===this.Y.O)return;if(this.Ui=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),e=Math.floor(t*s*i),n=Math.floor(t*i),h=Math.min(e,n);return Math.max(Math.floor(i),h)}(this.Y.Ki,i),this.Ui>=2){Math.floor(i)%2!=this.Ui%2&&this.Ui--}const n=this.Y.Yi;this.Y.es&&this.ns(t,n,this.Y.O,i),this.Y.hs&&this.rs(t,n,this.Y.O,this.Y.Ki,i);const h=this.ls(i);(!this.Y.hs||this.Ui>2*h)&&this.os(t,n,this.Y.O,i)}ns(t,i,s,e){if(null===this.Y)return;let n="",h=Math.min(Math.floor(e),Math.floor(this.Y.Ki*e));h=Math.max(Math.floor(e),Math.min(h,this.Ui));const r=Math.floor(.5*h);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.barWickColor!==n&&(t.fillStyle=s.barWickColor,n=s.barWickColor);const o=Math.round(Math.min(s.openY,s.closeY)*e),u=Math.round(Math.max(s.openY,s.closeY)*e),c=Math.round(s.highY*e),_=Math.round(s.lowY*e);let d=Math.round(e*s.x)-r;const f=d+h-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,c,p,o-c),t.fillRect(d,u+1,p,_-u),l=f}}ls(t){let i=Math.floor(1*t);this.Ui<=2*i&&(i=Math.floor(.5*(this.Ui-1)));const s=Math.max(Math.floor(t),i);return this.Ui<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}rs(t,i,s,e,n){if(null===this.Y)return;let h="";const r=this.ls(n);let l=null;for(let e=s.from;e<s.to;e++){const s=i[e];s.barBorderColor!==h&&(t.fillStyle=s.barBorderColor,h=s.barBorderColor);let a=Math.round(s.x*n)-Math.floor(.5*this.Ui);const o=a+this.Ui-1,u=Math.round(Math.min(s.openY,s.closeY)*n),c=Math.round(Math.max(s.openY,s.closeY)*n);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Y.Ki*n>2*r)N(t,a,u,o-a+1,c-u+1,r);else{const i=o-a+1;t.fillRect(a,u,i,c-u+1)}l=o}}os(t,i,s,e){if(null===this.Y)return;let n="";const h=this.ls(e);for(let r=s.from;r<s.to;r++){const s=i[r];let l=Math.round(Math.min(s.openY,s.closeY)*e),a=Math.round(Math.max(s.openY,s.closeY)*e),o=Math.round(s.x*e)-Math.floor(.5*this.Ui),u=o+this.Ui-1;if(s.barColor!==n){const i=s.barColor;t.fillStyle=i,n=i}this.Y.hs&&(o+=h,l+=h,u-=h,a-=h),l>a||t.fillRect(o,l,u-o+1,a-l+1)}}}class Bt extends Ct{constructor(){super(...arguments),this.Oi=new Ot}ji(t,i,s){return Object.assign(Object.assign({},this.Ji(t,i,s)),s.barStyle(t))}Wi(){const t=this.Li.options();this.Oi.A({Yi:this.Pi,Ki:this.Ri.timeScale().barSpacing(),es:t.wickVisible,hs:t.borderVisible,O:this.Di})}}class It{constructor(){this.Y=null,this.us=[]}A(t){this.Y=t,this.us=[]}draw(t,i,s,e){if(null===this.Y||0===this.Y.B.length||null===this.Y.O)return;this.us.length||this.cs(i);const n=Math.max(1,Math.floor(i)),h=Math.round(this.Y._s*i)-Math.floor(n/2),r=h+n;for(let s=this.Y.O.from;s<this.Y.O.to;s++){const e=this.Y.B[s],l=this.us[s-this.Y.O.from],a=Math.round(e.y*i);let o,u;t.fillStyle=e.ds,a<=h?(o=a,u=r):(o=h,u=a-Math.floor(n/2)+n),t.fillRect(l.fs,o,l.ps-l.fs+1,u-o)}}cs(t){if(null===this.Y||0===this.Y.B.length||null===this.Y.O)return void(this.us=[]);const i=Math.ceil(this.Y.Ki*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Y.Ki*t)-i;this.us=new Array(this.Y.O.to-this.Y.O.from);for(let i=this.Y.O.from;i<this.Y.O.to;i++){const e=this.Y.B[i],n=Math.round(e.x*t);let h,r;if(s%2){const t=(s-1)/2;h=n-t,r=n+t}else{const t=s/2;h=n-t,r=n+t-1}this.us[i-this.Y.O.from]={fs:h,ps:r,vs:n,gs:e.x*t,Ft:e.time}}for(let t=this.Y.O.from+1;t<this.Y.O.to;t++){const s=this.us[t-this.Y.O.from],e=this.us[t-this.Y.O.from-1];s.Ft===e.Ft+1&&(s.fs-e.ps!==i+1&&(e.vs>e.gs?e.ps=s.fs-i-1:s.fs=e.ps+i+1))}let e=Math.ceil(this.Y.Ki*t);for(let t=this.Y.O.from;t<this.Y.O.to;t++){const i=this.us[t-this.Y.O.from];i.ps<i.fs&&(i.ps=i.fs);const s=i.ps-i.fs+1;e=Math.min(s,e)}if(i>0&&e<4)for(let t=this.Y.O.from;t<this.Y.O.to;t++){const i=this.us[t-this.Y.O.from];i.ps-i.fs+1>e&&(i.vs>i.gs?i.ps-=1:i.fs+=1)}}}class Nt extends St{constructor(){super(...arguments),this.Oi=new It}ji(t,i,s){return Object.assign(Object.assign({},this.zi(t,i)),s.barStyle(t))}Wi(){const t={B:this.Pi,Ki:this.Ri.timeScale().barSpacing(),O:this.Di,_s:this.Li.priceScale().priceToCoordinate(this.Li.options().base,r(this.Li.firstValue()).value)};this.Oi.A(t)}}class Vt extends St{constructor(){super(...arguments),this.Oi=new pt}ji(t,i,s){return Object.assign(Object.assign({},this.zi(t,i)),s.barStyle(t))}Wi(){const t=this.Li.options(),i={B:this.Pi,et:t.lineStyle,bi:t.lineType,I:t.lineWidth,O:this.Di,gi:this.Ri.timeScale().barSpacing()};this.Oi.A(i)}}const Ft=/[2-9]/g;class Wt{constructor(t=50){this.bs=0,this.ws=1,this.Ms=1,this.Ss={},this.ys=new Map,this.ks=t}reset(){this.bs=0,this.ys.clear(),this.ws=1,this.Ms=1,this.Ss={}}measureText(t,i,s){return this.Cs(t,i,s).width}yMidCorrection(t,i,s){const e=this.Cs(t,i,s);return((e.actualBoundingBoxAscent||0)-(e.actualBoundingBoxDescent||0))/2}Cs(t,i,s){const e=s||Ft,n=String(i).replace(e,"0");if(this.ys.has(n))return h(this.ys.get(n)).xs;if(this.bs===this.ks){const t=this.Ss[this.Ms];delete this.Ss[this.Ms],this.ys.delete(t),this.Ms++,this.bs--}t.save(),t.textBaseline="middle";const r=t.measureText(n);return t.restore(),0===r.width&&i.length||(this.ys.set(n,{xs:r,Ts:this.ws}),this.Ss[this.ws]=n,this.bs++,this.ws++),r}}class zt{constructor(t){this.Ps=null,this.m=null,this.Ds="right",this.Ls=0,this.Rs=t}Es(t,i,s,e){this.Ps=t,this.m=i,this.Ls=s,this.Ds=e}draw(t,i){null!==this.m&&null!==this.Ps&&this.Ps.draw(t,this.m,this.Rs,this.Ls,this.Ds,i)}}class jt{constructor(t,i,s){this.As=t,this.Rs=new Wt(50),this.Os=i,this.g=s,this.M=-1,this.ht=new zt(this.Rs)}renderer(t,i){const s=this.g.paneForSource(this.Os);if(null===s)return null;const e=s.isOverlay(this.Os)?s.defaultVisiblePriceScale():this.Os.priceScale();if(null===e)return null;const n=s.priceScalePosition(e);if("overlay"===n)return null;const h=this.g.priceAxisRendererOptions();return h.fontSize!==this.M&&(this.M=h.fontSize,this.Rs.reset()),this.ht.Es(this.As.paneRenderer(),h,i,n),this.ht}}class Ht{constructor(){this.Y=null}A(t){this.Y=t}hitTest(t,i){var s;if(!(null===(s=this.Y)||void 0===s?void 0:s.X))return null;const{J:e,I:n,Bs:h}=this.Y;return i>=e-n-7&&i<=e+n+7?{hitTestData:this.Y,externalId:h}:null}draw(t,i,n,h){if(null===this.Y)return;if(!1===this.Y.X)return;const r=Math.round(this.Y.J*i);if(r<0||r>Math.ceil(this.Y.Is*i))return;const l=Math.ceil(this.Y.Ns*i);t.lineCap="butt",t.strokeStyle=this.Y.st,t.lineWidth=Math.floor(this.Y.I*i),s(t,this.Y.et),e(t,r,0,l)}}class $t{constructor(t){this.Vs={Ns:0,Is:0,J:0,st:"rgba(0, 0, 0, 0)",I:1,et:0,X:!1},this.Fs=new Ht,this.$=!0,this.Li=t,this.Ri=t.model(),this.Fs.A(this.Vs)}lt(){this.$=!0}renderer(t,i){return this.Li.visible()?(this.$&&(this.Ws(t,i),this.$=!1),this.Fs):null}}class Ut extends $t{constructor(t){super(t)}Ws(t,i){this.Vs.X=!1;const s=this.Li.priceScale(),e=s.mode().mode;if(2!==e&&3!==e)return;const n=this.Li.options();if(!n.baseLineVisible||!this.Li.visible())return;const h=this.Li.firstValue();null!==h&&(this.Vs.X=!0,this.Vs.J=s.priceToCoordinate(h.value,h.value),this.Vs.Ns=i,this.Vs.Is=t,this.Vs.st=n.baseLineColor,this.Vs.I=n.baseLineWidth,this.Vs.et=n.baseLineStyle)}}class qt{constructor(){this.Y=null}A(t){this.Y=t}zs(){return this.Y}draw(t,i,s,e){const n=this.Y;if(null===n)return;t.save();const h=Math.max(1,Math.floor(i)),r=h%2/2,l=Math.round(n.gs.x*i)+r,a=n.gs.y*i;t.fillStyle=n.js,t.beginPath();const o=Math.max(2,1.5*n.Hs)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.$s,t.beginPath(),t.arc(l,a,n.V*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=h,t.strokeStyle=n.Us,t.beginPath(),t.arc(l,a,n.V*i+h/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const Yt=[{qs:0,Ys:.25,Xs:4,Zs:10,Ks:.25,Gs:0,Js:.4,Qs:.8},{qs:.25,Ys:.525,Xs:10,Zs:14,Ks:0,Gs:0,Js:.8,Qs:0},{qs:.525,Ys:1,Xs:14,Zs:14,Ks:0,Gs:0,Js:0,Qs:0}];function Xt(t,i,s,e){return function(t,i){if("transparent"===t)return t;const s=p(t),e=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*e})`}(t,s+(e-s)*i)}function Zt(t,i){const s=t%2600/2600;let e;for(const t of Yt)if(s>=t.qs&&s<=t.Ys){e=t;break}n(void 0!==e,"Last price animation internal logic error");const h=(s-e.qs)/(e.Ys-e.qs);return{$s:Xt(i,h,e.Ks,e.Gs),Us:Xt(i,h,e.Js,e.Qs),V:(r=h,l=e.Xs,a=e.Zs,l+(a-l)*r)};var r,l,a}class Kt{constructor(t){this.ht=new qt,this.$=!0,this.te=!0,this.ie=performance.now(),this.se=this.ie-1,this.ee=t}ne(){this.se=this.ie-1,this.update()}he(){if(this.update(),2===this.ee.options().lastPriceAnimation){const t=performance.now(),i=this.se-t;if(i>0)return void(i<650&&(this.se+=2600));this.ie=t,this.se=t+2600}}update(){this.$=!0}re(){this.te=!0}X(){return 0!==this.ee.options().lastPriceAnimation}le(){switch(this.ee.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.se}}renderer(t,i){return this.$?(this.q(t,i),this.$=!1,this.te=!1):this.te&&(this.ae(),this.te=!1),this.ht}q(t,i){this.ht.A(null);const s=this.ee.model().timeScale(),e=s.visibleStrictRange(),n=this.ee.firstValue();if(null===e||null===n)return;const h=this.ee.lastValueData(!0);if(h.noData||!e.contains(h.index))return;const r={x:s.indexToCoordinate(h.index),y:this.ee.priceScale().priceToCoordinate(h.price,n.value)},l=h.color,a=this.ee.options().lineWidth,o=Zt(this.oe(),l);this.ht.A({js:l,Hs:a,$s:o.$s,Us:o.Us,V:o.V,gs:r})}ae(){const t=this.ht.zs();if(null!==t){const i=Zt(this.oe(),t.js);t.$s=i.$s,t.Us=i.Us,t.V=i.V}}oe(){return this.le()?performance.now()-this.ie:2599}}function Gt(t,i){return Lt(Math.min(Math.max(t,12),30)*i)}function Jt(t,i){switch(t){case"arrowDown":case"arrowUp":return Gt(i,1);case"circle":return Gt(i,.8);case"square":return Gt(i,.7)}}function Qt(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(Gt(t,1))}function ti(t){return Math.max(Gt(t,.1),3)}function ii(t,i,s,e,n){const h=Jt("square",s),r=(h-1)/2,l=t-r,a=i-r;return e>=l&&e<=l+h&&n>=a&&n<=a+h}function si(t,i,s,e,n){const h=(Jt("arrowUp",n)-1)/2,r=(Lt(n/2)-1)/2;i.beginPath(),t?(i.moveTo(s-h,e),i.lineTo(s,e-h),i.lineTo(s+h,e),i.lineTo(s+r,e),i.lineTo(s+r,e+h),i.lineTo(s-r,e+h),i.lineTo(s-r,e)):(i.moveTo(s-h,e),i.lineTo(s,e+h),i.lineTo(s+h,e),i.lineTo(s+r,e),i.lineTo(s+r,e-h),i.lineTo(s-r,e-h),i.lineTo(s-r,e)),i.fill()}function ei(t,i,s,e,n,h){return ii(i,s,e,n,h)}class ni extends L{constructor(){super(...arguments),this.Y=null,this.Rs=new Wt,this.M=-1,this.S="",this.ue=""}A(t){this.Y=t}Es(t,i){this.M===t&&this.S===i||(this.M=t,this.S=i,this.ue=T(t,i),this.Rs.reset())}hitTest(t,i){if(null===this.Y||null===this.Y.O)return null;for(let s=this.Y.O.from;s<this.Y.O.to;s++){const e=this.Y.B[s];if(ri(e,t,i))return{hitTestData:e.ce,externalId:e.Bs}}return null}D(t,i,s){if(null!==this.Y&&null!==this.Y.O){t.textBaseline="middle",t.font=this.ue;for(let i=this.Y.O.from;i<this.Y.O.to;i++){const s=this.Y.B[i];void 0!==s._e&&(s._e.Ns=this.Rs.measureText(t,s._e.de),s._e.Is=this.M),hi(s,t)}}}}function hi(t,i){i.fillStyle=t.st,void 0!==t._e&&function(t,i,s,e){t.fillText(i,s,e)}(i,t._e.de,t.x-t._e.Ns/2,t._e.J),function(t,i){if(0===t.fe)return;switch(t.pe){case"arrowDown":return void si(!1,i,t.x,t.J,t.fe);case"arrowUp":return void si(!0,i,t.x,t.J,t.fe);case"circle":return void function(t,i,s,e){const n=(Jt("circle",e)-1)/2;t.beginPath(),t.arc(i,s,n,0,2*Math.PI,!1),t.fill()}(i,t.x,t.J,t.fe);case"square":return void function(t,i,s,e){const n=Jt("square",e),h=(n-1)/2,r=i-h,l=s-h;t.fillRect(r,l,n,n)}(i,t.x,t.J,t.fe)}t.pe}(t,i)}function ri(t,i,s){return!(void 0===t._e||!function(t,i,s,e,n,h){const r=e/2;return n>=t&&n<=t+s&&h>=i-r&&h<=i+r}(t.x,t._e.J,t._e.Ns,t._e.Is,i,s))||function(t,i,s){if(0===t.fe)return!1;switch(t.pe){case"arrowDown":case"arrowUp":return ei(0,t.x,t.J,t.fe,i,s);case"circle":return function(t,i,s,e,n){const h=2+Jt("circle",s)/2,r=t-e,l=i-n;return Math.sqrt(r*r+l*l)<=h}(t.x,t.J,t.fe,i,s);case"square":return ii(t.x,t.J,t.fe,i,s)}}(t,i,s)}function li(t,i,s,e,n,h,r,l,a){const o=b(s)?s:s.close,u=b(s)?s:s.high,c=b(s)?s:s.low,_=b(i.size)?Math.max(i.size,0):1,d=Qt(l.barSpacing())*_,f=d/2;switch(t.fe=d,i.position){case"inBar":return t.J=r.priceToCoordinate(o,a),void(void 0!==t._e&&(t._e.J=t.J+f+h+.6*n));case"aboveBar":return t.J=r.priceToCoordinate(u,a)-f-e.ve,void 0!==t._e&&(t._e.J=t.J-f-.6*n,e.ve+=1.2*n),void(e.ve+=d+h);case"belowBar":return t.J=r.priceToCoordinate(c,a)+f+e.me,void 0!==t._e&&(t._e.J=t.J+f+h+.6*n,e.me+=1.2*n),void(e.me+=d+h)}i.position}class ai{constructor(t,i){this.$=!0,this.ge=!0,this.be=!0,this.we=null,this.ht=new ni,this.ee=t,this.Vt=i,this.Y={B:[],O:null}}update(t){this.$=!0,this.be=!0,"data"===t&&(this.ge=!0)}renderer(t,i,s){if(!this.ee.visible())return null;this.$&&this.Me();const e=this.Vt.options().layout;return this.ht.Es(e.fontSize,e.fontFamily),this.ht.A(this.Y),this.ht}Se(){if(this.be){if(this.ee.indexedMarkers().length>0){const t=this.Vt.timeScale().barSpacing(),i=ti(t),s=1.5*Qt(t)+2*i;this.we={above:s,below:s}}else this.we=null;this.be=!1}return this.we}Me(){const t=this.ee.priceScale(),i=this.Vt.timeScale(),s=this.ee.indexedMarkers();this.ge&&(this.Y.B=s.map((t=>({time:t.time,x:0,J:0,fe:0,pe:t.shape,st:t.color,ce:t.internalId,Bs:t.id,_e:void 0}))),this.ge=!1);const e=this.Vt.options().layout;this.Y.O=null;const n=i.visibleStrictRange();if(null===n)return;const h=this.ee.firstValue();if(null===h)return;if(0===this.Y.B.length)return;let r=NaN;const l=ti(i.barSpacing()),a={ve:l,me:l};this.Y.O=wt(this.Y.B,n,!0);for(let n=this.Y.O.from;n<this.Y.O.to;n++){const o=s[n];o.time!==r&&(a.ve=l,a.me=l,r=o.time);const u=this.Y.B[n];u.x=i.indexToCoordinate(o.time),void 0!==o.text&&o.text.length>0&&(u._e={de:o.text,J:0,Ns:0,Is:0});const c=this.ee.dataAt(o.time);null!==c&&li(u,o,c,a,e.fontSize,l,t,i,h.value)}this.$=!1}}class oi extends $t{constructor(t){super(t)}Ws(t,i){const s=this.Vs;s.X=!1;const e=this.Li.options();if(!e.priceLineVisible||!this.Li.visible())return;const n=this.Li.lastValueData(0===e.priceLineSource);n.noData||(s.X=!0,s.J=n.coordinate,s.st=this.Li.priceLineColor(n.color),s.Ns=i,s.Is=t,s.I=e.priceLineWidth,s.et=e.priceLineStyle)}}class ui extends U{constructor(t){super(),this.rt=t}At(t,i,s){t.visible=!1,i.visible=!1;const e=this.rt;if(!e.visible())return;const n=e.options(),h=n.lastValueVisible,r=""!==e.title(),l=0===n.seriesLastValueMode,a=e.lastValueData(!1);if(a.noData)return;h&&(t.text=this.ye(a,h,l),t.visible=0!==t.text.length),(r||l)&&(i.text=this.ke(a,h,r,l),i.visible=i.text.length>0);const o=e.priceLineColor(a.color),u=v(o);s.background=u.t,s.color=u.i,s.coordinate=a.coordinate,i.borderColor=e.model().backgroundColorAtYPercentFromTop(a.coordinate/e.priceScale().height()),t.borderColor=o,t.color=s.color,i.color=s.color}ke(t,i,s,e){let n="";const h=this.rt.title();return s&&0!==h.length&&(n+=`${h} `),i&&e&&(n+=this.rt.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),n.trim()}ye(t,i,s){return i?s?this.rt.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""}}class ci{constructor(t,i){this.Ce=t,this.xe=i}equals(t){return null!==t&&(this.Ce===t.Ce&&this.xe===t.xe)}clone(){return new ci(this.Ce,this.xe)}minValue(){return this.Ce}maxValue(){return this.xe}length(){return this.xe-this.Ce}isEmpty(){return this.xe===this.Ce||Number.isNaN(this.xe)||Number.isNaN(this.Ce)}merge(t){return null===t?this:new ci(Math.min(this.minValue(),t.minValue()),Math.max(this.maxValue(),t.maxValue()))}scaleAroundCenter(t){if(!b(t))return;if(0===this.xe-this.Ce)return;const i=.5*(this.xe+this.Ce);let s=this.xe-i,e=this.Ce-i;s*=t,e*=t,this.xe=i+s,this.Ce=i+e}shift(t){b(t)&&(this.xe+=t,this.Ce+=t)}toRaw(){return{minValue:this.Ce,maxValue:this.xe}}static fromRaw(t){return null===t?null:new ci(t.minValue,t.maxValue)}}class _i{constructor(t,i){this.Te=t,this.Pe=i||null}priceRange(){return this.Te}margins(){return this.Pe}toRaw(){return null===this.Te?null:{priceRange:this.Te.toRaw(),margins:this.Pe||void 0}}static fromRaw(t){return null===t?null:new _i(ci.fromRaw(t.priceRange),t.margins)}}class di extends $t{constructor(t,i){super(t),this.De=i}Ws(t,i){const s=this.Vs;s.X=!1;const e=this.De.options();if(!this.Li.visible()||!e.lineVisible)return;const n=this.De.yCoord();null!==n&&(s.X=!0,s.J=n,s.st=e.color,s.Ns=i,s.Is=t,s.I=e.lineWidth,s.et=e.lineStyle,s.Bs=this.De.options().id)}}class fi extends U{constructor(t,i){super(),this.ee=t,this.De=i}At(t,i,s){t.visible=!1,i.visible=!1;const e=this.De.options(),n=e.axisLabelVisible,h=""!==e.title,r=this.ee;if(!n||!r.visible())return;const l=this.De.yCoord();if(null===l)return;h&&(i.text=e.title,i.visible=!0),i.borderColor=r.model().backgroundColorAtYPercentFromTop(l/r.priceScale().height()),t.text=this.Le(e.price),t.visible=!0;const a=v(e.color);s.background=a.t,s.color=a.i,s.coordinate=l}Le(t){const i=this.ee.firstValue();return null===i?"":this.ee.priceScale().formatPrice(t,i.value)}}class pi{constructor(t,i){this.ee=t,this.Gt=i,this.Re=new di(t,this),this.As=new fi(t,this),this.Ee=new jt(this.As,t,t.model())}applyOptions(t){g(this.Gt,t),this.update(),this.ee.model().lightUpdate()}options(){return this.Gt}paneView(){return this.Re}labelPaneView(){return this.Ee}priceAxisView(){return this.As}update(){this.Re.lt(),this.As.update()}yCoord(){const t=this.ee,i=t.priceScale();if(t.model().timeScale().isEmpty()||i.isEmpty())return null;const s=t.firstValue();return null===s?null:i.priceToCoordinate(this.Gt.price,s.value)}}class vi extends K{constructor(t){super(),this.Vt=t}model(){return this.Vt}}const mi={Bar:(t,i,s,e)=>{var n;const h=i.upColor,a=i.downColor,o=r(t(s,e)),u=l(o.value[0])<=l(o.value[3]);return{barColor:null!==(n=o.color)&&void 0!==n?n:u?h:a}},Candlestick:(t,i,s,e)=>{var n,h,a;const o=i.upColor,u=i.downColor,c=i.borderUpColor,_=i.borderDownColor,d=i.wickUpColor,f=i.wickDownColor,p=r(t(s,e)),v=l(p.value[0])<=l(p.value[3]);return{barColor:null!==(n=p.color)&&void 0!==n?n:v?o:u,barBorderColor:null!==(h=p.borderColor)&&void 0!==h?h:v?c:_,barWickColor:null!==(a=p.wickColor)&&void 0!==a?a:v?d:f}},Area:(t,i,s,e)=>{var n,h,l,a;const o=r(t(s,e));return{barColor:null!==(n=o.lineColor)&&void 0!==n?n:i.lineColor,lineColor:null!==(h=o.lineColor)&&void 0!==h?h:i.lineColor,topColor:null!==(l=o.topColor)&&void 0!==l?l:i.topColor,bottomColor:null!==(a=o.bottomColor)&&void 0!==a?a:i.bottomColor}},Baseline:(t,i,s,e)=>{var n,h,l,a,o,u;const c=r(t(s,e));return{barColor:c.value[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,topLineColor:null!==(n=c.topLineColor)&&void 0!==n?n:i.topLineColor,bottomLineColor:null!==(h=c.bottomLineColor)&&void 0!==h?h:i.bottomLineColor,topFillColor1:null!==(l=c.topFillColor1)&&void 0!==l?l:i.topFillColor1,topFillColor2:null!==(a=c.topFillColor2)&&void 0!==a?a:i.topFillColor2,bottomFillColor1:null!==(o=c.bottomFillColor1)&&void 0!==o?o:i.bottomFillColor1,bottomFillColor2:null!==(u=c.bottomFillColor2)&&void 0!==u?u:i.bottomFillColor2}},Line:(t,i,s,e)=>{var n,h;const l=r(t(s,e));return{barColor:null!==(n=l.color)&&void 0!==n?n:i.color,lineColor:null!==(h=l.color)&&void 0!==h?h:i.color}},Histogram:(t,i,s,e)=>{var n;return{barColor:null!==(n=r(t(s,e)).color)&&void 0!==n?n:i.color}}};class gi{constructor(t){this.Ae=(t,i)=>void 0!==i?i.value:this.ee.bars().valueAt(t),this.ee=t,this.Oe=mi[t.seriesType()]}barStyle(t,i){return this.Oe(this.Ae,this.ee.options(),t,i)}}var bi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(bi||(bi={}));const wi=30;class Mi{constructor(){this.Be=[],this.Ie=new Map,this.Ne=new Map}last(){return this.size()>0?this.Be[this.Be.length-1]:null}firstIndex(){return this.size()>0?this.Ve(0):null}lastIndex(){return this.size()>0?this.Ve(this.Be.length-1):null}size(){return this.Be.length}isEmpty(){return 0===this.size()}contains(t){return null!==this.Fe(t,0)}valueAt(t){return this.search(t)}search(t,i=0){const s=this.Fe(t,i);return null===s?null:Object.assign(Object.assign({},this.We(s)),{index:this.Ve(s)})}rows(){return this.Be}minMaxOnRangeCached(t,i,s){if(this.isEmpty())return null;let e=null;for(const n of s){e=Si(e,this.ze(t,i,n))}return e}setData(t){this.Ne.clear(),this.Ie.clear(),this.Be=t}Ve(t){return this.Be[t].index}We(t){return this.Be[t]}Fe(t,i){const s=this.je(t);if(null===s&&0!==i)switch(i){case-1:return this.He(t);case 1:return this.$e(t);default:throw new TypeError("Unknown search mode")}return s}He(t){let i=this.Ue(t);return i>0&&(i-=1),i!==this.Be.length&&this.Ve(i)<t?i:null}$e(t){const i=this.qe(t);return i!==this.Be.length&&t<this.Ve(i)?i:null}je(t){const i=this.Ue(t);return i===this.Be.length||t<this.Be[i].index?null:i}Ue(t){return vt(this.Be,t,((t,i)=>t.index<i))}qe(t){return mt(this.Be,t,((t,i)=>i.index>t))}Ye(t,i,s){let e=null;for(let n=t;n<i;n++){const t=this.Be[n].value[s];Number.isNaN(t)||(null===e?e={min:t,max:t}:(t<e.min&&(e.min=t),t>e.max&&(e.max=t)))}return e}ze(t,i,s){if(this.isEmpty())return null;let e=null;const n=r(this.firstIndex()),h=r(this.lastIndex()),l=Math.max(t,n),a=Math.min(i,h),o=Math.ceil(l/wi)*wi,u=Math.max(o,Math.floor(a/wi)*wi);{const t=this.Ue(l),n=this.qe(Math.min(a,o,i));e=Si(e,this.Ye(t,n,s))}let c=this.Ie.get(s);void 0===c&&(c=new Map,this.Ie.set(s,c));for(let t=Math.max(o+1,l);t<u;t+=wi){const i=Math.floor(t/wi);let n=c.get(i);if(void 0===n){const t=this.Ue(i*wi),e=this.qe((i+1)*wi-1);n=this.Ye(t,e,s),c.set(i,n)}e=Si(e,n)}{const t=this.Ue(u),i=this.qe(a);e=Si(e,this.Ye(t,i,s))}return e}}function Si(t,i){if(null===t)return i;if(null===i)return t;return{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}class yi extends vi{constructor(t,i,s){super(t),this.Y=new Mi,this.Re=new oi(this),this.Xe=[],this.Ze=new Ut(this),this.Ke=null,this.Ge=null,this.Je=[],this.Qe=[],this.tn=null,this.Gt=i,this.sn=s;const e=new ui(this);this.Ut=[e],this.Ee=new jt(e,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Ke=new Kt(this)),this.en(),this.nn()}destroy(){null!==this.tn&&clearTimeout(this.tn)}priceLineColor(t){return this.Gt.priceLineColor||t}lastValueData(t){const i={noData:!0},s=this.priceScale();if(this.model().timeScale().isEmpty()||s.isEmpty()||this.Y.isEmpty())return i;const e=this.model().timeScale().visibleStrictRange(),n=this.firstValue();if(null===e||null===n)return i;let h,r;if(t){const t=this.Y.last();if(null===t)return i;h=t,r=t.index}else{const t=this.Y.search(e.right(),-1);if(null===t)return i;if(h=this.Y.valueAt(t.index),null===h)return i;r=t.index}const l=h.value[3],a=this.barColorer().barStyle(r,{value:h}),o=s.priceToCoordinate(l,n.value);return{noData:!1,price:l,text:s.formatPrice(l,n.value),formattedPriceAbsolute:s.formatPriceAbsolute(l),formattedPricePercentage:s.formatPricePercentage(l,n.value),color:a.barColor,coordinate:o,index:r}}barColorer(){return null!==this.Ge||(this.Ge=new gi(this)),this.Ge}options(){return this.Gt}applyOptions(t){const i=t.priceScaleId;void 0!==i&&i!==this.Gt.priceScaleId&&this.model().moveSeriesToScale(this,i),g(this.Gt,t),void 0!==t.priceFormat&&(this.en(),this.model().fullUpdate()),this.model().updateSource(this),this.model().updateCrosshair(),this.ii.update("options")}setData(t,i){this.Y.setData(t),this.hn(),this.ii.update("data"),this.Jt.update("data"),null!==this.Ke&&(i&&i.lastBarUpdatedOrNewBarsAddedToTheRight?this.Ke.he():0===t.length&&this.Ke.ne());const s=this.model().paneForSource(this);this.model().recalculatePane(s),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}setMarkers(t){this.Je=t,this.hn();const i=this.model().paneForSource(this);this.Jt.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}markers(){return this.Je}indexedMarkers(){return this.Qe}createPriceLine(t){const i=new pi(this,t);return this.Xe.push(i),this.model().updateSource(this),i}removePriceLine(t){const i=this.Xe.indexOf(t);-1!==i&&this.Xe.splice(i,1),this.model().updateSource(this)}customPriceLines(){return this.Xe}seriesType(){return this.sn}firstValue(){const t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}}firstBar(){const t=this.model().timeScale().visibleStrictRange();if(null===t)return null;const i=t.left();return this.Y.search(i,1)}bars(){return this.Y}dataAt(t){const i=this.Y.valueAt(t);return null===i?null:"Bar"===this.sn||"Candlestick"===this.sn?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:i.value[3]}topPaneViews(t){const i=this.Ke;return null!==i&&i.X()?(null===this.tn&&i.le()&&(this.tn=setTimeout((()=>{this.tn=null,this.model().cursorUpdate()}),0)),i.re(),[i]):[]}paneViews(){const t=[];this.rn()||t.push(this.Ze),t.push(this.ii,this.Re,this.Jt);const i=this.Xe.map((t=>t.paneView()));return t.push(...i),t}labelPaneViews(t){return[this.Ee,...this.Xe.map((t=>t.labelPaneView()))]}priceAxisViews(t,i){if(i!==this._priceScale&&!this.rn())return[];const s=[...this.Ut];for(const t of this.Xe)s.push(t.priceAxisView());return s}autoscaleInfo(t,i){if(void 0!==this.Gt.autoscaleInfoProvider){const s=this.Gt.autoscaleInfoProvider((()=>{const s=this.ln(t,i);return null===s?null:s.toRaw()}));return _i.fromRaw(s)}return this.ln(t,i)}minMove(){return this.Gt.priceFormat.minMove}formatter(){return this.an}updateAllViews(){var t;this.ii.update(),this.Jt.update();for(const t of this.Ut)t.update();for(const t of this.Xe)t.update();this.Re.lt(),this.Ze.lt(),null===(t=this.Ke)||void 0===t||t.update()}priceScale(){return r(super.priceScale())}markerDataAtIndex(t){if(!(("Line"===this.sn||"Area"===this.sn||"Baseline"===this.sn)&&this.Gt.crosshairMarkerVisible))return null;const i=this.Y.valueAt(t);if(null===i)return null;return{price:i.value[3],radius:this.on(),borderColor:this.un(),borderWidth:this.cn(),backgroundColor:this._n(t)}}title(){return this.Gt.title}visible(){return this.Gt.visible}rn(){return!Q(this.priceScale().id())}ln(t,i){if(!w(t)||!w(i)||this.Y.isEmpty())return null;const s="Line"===this.sn||"Area"===this.sn||"Baseline"===this.sn||"Histogram"===this.sn?[3]:[2,1],e=this.Y.minMaxOnRangeCached(t,i,s);let n=null!==e?new ci(e.min,e.max):null;if("Histogram"===this.seriesType()){const t=this.Gt.base,i=new ci(t,t);n=null!==n?n.merge(i):i}return new _i(n,this.Jt.Se())}on(){switch(this.sn){case"Line":case"Area":case"Baseline":return this.Gt.crosshairMarkerRadius}return 0}un(){switch(this.sn){case"Line":case"Area":case"Baseline":{const t=this.Gt.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}cn(){switch(this.sn){case"Line":case"Area":case"Baseline":return this.Gt.crosshairMarkerBorderWidth}return 0}_n(t){switch(this.sn){case"Line":case"Area":case"Baseline":{const t=this.Gt.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.barColorer().barStyle(t).barColor}en(){switch(this.Gt.priceFormat.type){case"custom":this.an={format:this.Gt.priceFormat.formatter};break;case"volume":this.an=new ht(this.Gt.priceFormat.precision);break;case"percent":this.an=new nt(this.Gt.priceFormat.precision);break;default:{const t=Math.pow(10,this.Gt.priceFormat.precision);this.an=new et(t,this.Gt.priceFormat.minMove*t)}}null!==this._priceScale&&this._priceScale.updateFormatter()}hn(){const t=this.model().timeScale();if(t.isEmpty()||0===this.Y.size())return void(this.Qe=[]);const i=r(this.Y.firstIndex());this.Qe=this.Je.map(((s,e)=>{const n=r(t.timeToIndex(s.time,!0)),h=n<i?1:-1;return{time:r(this.Y.search(n,h)).index,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:e,text:s.text,size:s.size}}))}nn(){switch(this.Jt=new ai(this,this.model()),this.sn){case"Bar":this.ii=new xt(this,this.model());break;case"Candlestick":this.ii=new Bt(this,this.model());break;case"Line":this.ii=new Vt(this,this.model());break;case"Area":this.ii=new yt(this,this.model());break;case"Baseline":this.ii=new At(this,this.model());break;case"Histogram":this.ii=new Nt(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.sn)}}}class ki{constructor(t){this.Gt=t}dn(t,i,s){let e=t;if(0===this.Gt.mode)return e;const n=s.defaultPriceScale(),h=n.firstValue();if(null===h)return e;const r=n.priceToCoordinate(t,h),a=s.dataSources().filter((t=>t instanceof yi)).reduce(((t,e)=>{if(s.isOverlay(e)||!e.visible())return t;const n=e.priceScale(),h=e.bars();if(n.isEmpty()||!h.contains(i))return t;const r=h.valueAt(i);if(null===r)return t;const a=l(e.firstValue());return t.concat([n.priceToCoordinate(r.value[3],a.value)])}),[]);if(0===a.length)return e;a.sort(((t,i)=>Math.abs(t-r)-Math.abs(i-r)));const o=a[0];return e=n.coordinateToPrice(o,h),e}}class Ci{constructor(){this.Y=null}A(t){this.Y=t}draw(t,i,e,n){if(null===this.Y)return;const h=Math.max(1,Math.floor(i));t.lineWidth=h;const l=Math.ceil(this.Y.it*i),a=Math.ceil(this.Y.tt*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const e=r(this.Y);if(e.fn){t.strokeStyle=e.pn,s(t,e.vn),t.beginPath();for(const s of e.mn){const e=Math.round(s.gn*i);t.moveTo(e,-h),t.lineTo(e,l+h)}t.stroke()}if(e.bn){t.strokeStyle=e.wn,s(t,e.Mn),t.beginPath();for(const s of e.Sn){const e=Math.round(s.coord*i);t.moveTo(-h,e),t.lineTo(a+h,e)}t.stroke()}}))}}class xi{constructor(t){this.ht=new Ci,this.$=!0,this.zt=t}update(){this.$=!0}renderer(t,i){if(this.$){const s=this.zt.model().options().grid,e={it:t,tt:i,bn:s.horzLines.visible,fn:s.vertLines.visible,wn:s.horzLines.color,pn:s.vertLines.color,Mn:s.horzLines.style,vn:s.vertLines.style,Sn:this.zt.defaultPriceScale().marks(),mn:this.zt.model().timeScale().marks()||[]};this.ht.A(e),this.$=!1}return this.ht}}class Ti{constructor(t){this.ii=new xi(t)}paneView(){return this.ii}}const Pi={yn:4,kn:1e-4};function Di(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Li(t,i){const s=Di(t.minValue(),i),e=Di(t.maxValue(),i);return new ci(s,e)}function Ri(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Ei(t,i){const s=Ri(t.minValue(),i),e=Ri(t.maxValue(),i);return new ci(s,e)}function Ai(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=Dt(s+i.kn)+i.yn;return t<0?-e:e}function Oi(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const e=Math.pow(10,s-i.yn)-i.kn;return t<0?-e:e}function Bi(t,i){if(null===t)return null;const s=Ai(t.minValue(),i),e=Ai(t.maxValue(),i);return new ci(s,e)}function Ii(t,i){if(null===t)return null;const s=Oi(t.minValue(),i),e=Oi(t.maxValue(),i);return new ci(s,e)}function Ni(t){if(null===t)return Pi;const i=Math.abs(t.maxValue()-t.minValue());if(i>=1||i<1e-15)return Pi;const s=Math.ceil(Math.abs(Math.log10(i))),e=Pi.yn+s;return{yn:e,kn:1/Math.pow(10,e)}}class Vi{constructor(t,i){if(this.Cn=t,this.xn=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.Cn))this.Tn=[2,2.5,2];else{this.Tn=[];for(let t=this.Cn;1!==t;){if(t%2==0)this.Tn.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Tn.push(2,2.5),t/=5}if(this.Tn.length>100)throw new Error("something wrong with base")}}}Pn(t,i,s){const e=0===this.Cn?0:1/this.Cn;let n=Math.pow(10,Math.max(0,Math.ceil(Dt(t-i)))),h=0,r=this.xn[0];for(;;){const t=Pt(n,e,1e-14)&&n>e+1e-14,i=Pt(n,s*r,1e-14),l=Pt(n,1,1e-14);if(!(t&&i&&l))break;n/=r,r=this.xn[++h%this.xn.length]}if(n<=e+1e-14&&(n=e),n=Math.max(1,n),this.Tn.length>0&&(l=n,a=1,o=1e-14,Math.abs(l-a)<o))for(h=0,r=this.Tn[0];Pt(n,s*r,1e-14)&&n>e+1e-14;)n/=r,r=this.Tn[++h%this.Tn.length];var l,a,o;return n}}class Fi{constructor(t,i,s,e){this.Dn=[],this.Ot=t,this.Cn=i,this.Ln=s,this.Rn=e}Pn(t,i){if(t<i)throw new Error("high < low");const s=this.Ot.height(),e=(t-i)*this.En()/s,n=new Vi(this.Cn,[2,2.5,2]),h=new Vi(this.Cn,[2,2,2.5]),r=new Vi(this.Cn,[2.5,2,2]),l=[];return l.push(n.Pn(t,i,e),h.Pn(t,i,e),r.Pn(t,i,e)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}An(){const t=this.Ot,i=t.firstValue();if(null===i)return void(this.Dn=[]);const s=t.height(),e=this.Ln(s-1,i),n=this.Ln(0,i),h=this.Ot.options().entireTextOnly?this.On()/2:0,r=h,l=s-1-h,a=Math.max(e,n),o=Math.min(e,n);if(a===o)return void(this.Dn=[]);let u=this.Pn(a,o),c=a%u;c+=c<0?u:0;const _=a>=o?1:-1;let d=null,f=0;for(let s=a-c;s>o;s-=u){const e=this.Rn(s,i,!0);null!==d&&Math.abs(e-d)<this.En()||(e<r||e>l||(f<this.Dn.length?(this.Dn[f].coord=e,this.Dn[f].label=t.formatLogical(s)):this.Dn.push({coord:e,label:t.formatLogical(s)}),f++,d=e,t.isLog()&&(u=this.Pn(s*_,o))))}this.Dn.length=f}Bn(){return this.Dn}On(){return this.Ot.fontSize()}En(){return Math.ceil(2.5*this.On())}}function Wi(t){return t.slice().sort(((t,i)=>r(t.zorder())-r(i.zorder())))}var zi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(zi||(zi={}));const ji=new nt,Hi=new et(100,1);class $i{constructor(t,i,s,e){this.In=0,this.Nn=null,this.Te=null,this.Vn=null,this.Fn={Wn:!1,zn:null},this.jn=0,this.Hn=0,this.$n=new m,this.Un=new m,this.qn=[],this.Yn=null,this.Xn=null,this.Zn=null,this.Kn=null,this.an=Hi,this.Gn=Ni(null),this.Jn=t,this.Gt=i,this.Qn=s,this.th=e,this.ih=new Fi(this,100,this.sh.bind(this),this.eh.bind(this))}id(){return this.Jn}options(){return this.Gt}applyOptions(t){if(g(this.Gt,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.nh(),this.Xn=null}}isAutoScale(){return this.Gt.autoScale}isLog(){return 1===this.Gt.mode}isPercentage(){return 2===this.Gt.mode}isIndexedTo100(){return 3===this.Gt.mode}mode(){return{autoScale:this.Gt.autoScale,isInverted:this.Gt.invertScale,mode:this.Gt.mode}}setMode(t){const i=this.mode();let s=null;void 0!==t.autoScale&&(this.Gt.autoScale=t.autoScale),void 0!==t.mode&&(this.Gt.mode=t.mode,2!==t.mode&&3!==t.mode||(this.Gt.autoScale=!0),this.Fn.Wn=!1),1===i.mode&&t.mode!==i.mode&&(!function(t,i){if(null===t)return!1;const s=Oi(t.minValue(),i),e=Oi(t.maxValue(),i);return isFinite(s)&&isFinite(e)}(this.Te,this.Gn)?this.Gt.autoScale=!0:(s=Ii(this.Te,this.Gn),null!==s&&this.setPriceRange(s))),1===t.mode&&t.mode!==i.mode&&(s=Bi(this.Te,this.Gn),null!==s&&this.setPriceRange(s));const e=i.mode!==this.Gt.mode;e&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),e&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.Gt.invertScale=t.isInverted,this.hh()),this.Un._(i,this.mode())}modeChanged(){return this.Un}fontSize(){return this.Qn.fontSize}height(){return this.In}setHeight(t){this.In!==t&&(this.In=t,this.nh(),this.Xn=null)}internalHeight(){if(this.Nn)return this.Nn;const t=this.height()-this.rh()-this.lh();return this.Nn=t,t}priceRange(){return this.ah(),this.Te}setPriceRange(t,i){const s=this.Te;(i||null===s&&null!==t||null!==s&&!s.equals(t))&&(this.Xn=null,this.Te=t)}isEmpty(){return this.ah(),0===this.In||!this.Te||this.Te.isEmpty()}invertedCoordinate(t){return this.isInverted()?t:this.height()-1-t}priceToCoordinate(t,i){return this.isPercentage()?t=Di(t,i):this.isIndexedTo100()&&(t=Ri(t,i)),this.eh(t,i)}pointsArrayToCoordinates(t,i,s){this.ah();const e=this.lh(),n=r(this.priceRange()),h=n.minValue(),l=n.maxValue(),a=this.internalHeight()-1,o=this.isInverted(),u=a/(l-h),c=void 0===s?0:s.from,_=void 0===s?t.length:s.to,d=this.oh();for(let s=c;s<_;s++){const n=t[s],r=n.price;if(isNaN(r))continue;let l=r;null!==d&&(l=d(n.price,i));const a=e+u*(l-h),c=o?a:this.In-1-a;n.y=c}}barPricesToCoordinates(t,i,s){this.ah();const e=this.lh(),n=r(this.priceRange()),h=n.minValue(),l=n.maxValue(),a=this.internalHeight()-1,o=this.isInverted(),u=a/(l-h),c=void 0===s?0:s.from,_=void 0===s?t.length:s.to,d=this.oh();for(let s=c;s<_;s++){const n=t[s];let r=n.open,l=n.high,a=n.low,c=n.close;null!==d&&(r=d(n.open,i),l=d(n.high,i),a=d(n.low,i),c=d(n.close,i));let _=e+u*(r-h),f=o?_:this.In-1-_;n.openY=f,_=e+u*(l-h),f=o?_:this.In-1-_,n.highY=f,_=e+u*(a-h),f=o?_:this.In-1-_,n.lowY=f,_=e+u*(c-h),f=o?_:this.In-1-_,n.closeY=f}}coordinateToPrice(t,i){const s=this.sh(t,i);return this.logicalToPrice(s,i)}logicalToPrice(t,i){let s=t;return this.isPercentage()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.isIndexedTo100()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}dataSources(){return this.qn}orderedSources(){if(this.Yn)return this.Yn;let t=[];for(let i=0;i<this.qn.length;i++){const s=this.qn[i];null===s.zorder()&&s.setZorder(i+1),t.push(s)}return t=Wi(t),this.Yn=t,this.Yn}addDataSource(t){-1===this.qn.indexOf(t)&&(this.qn.push(t),this.updateFormatter(),this.invalidateSourcesCache())}removeDataSource(t){const i=this.qn.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.qn.splice(i,1),0===this.qn.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()}firstValue(){let t=null;for(const i of this.qn){const s=i.firstValue();null!==s&&((null===t||s.timePoint<t.timePoint)&&(t=s))}return null===t?null:t.value}isInverted(){return this.Gt.invertScale}marks(){const t=null===this.firstValue();if(null!==this.Xn&&(t||this.Xn.uh===t))return this.Xn.Bn;this.ih.An();const i=this.ih.Bn();return this.Xn={Bn:i,uh:t},this.$n._(),i}onMarksChanged(){return this.$n}startScale(t){this.isPercentage()||this.isIndexedTo100()||null===this.Zn&&null===this.Vn&&(this.isEmpty()||(this.Zn=this.In-t,this.Vn=r(this.priceRange()).clone()))}scaleTo(t){if(this.isPercentage()||this.isIndexedTo100())return;if(null===this.Zn)return;this.setMode({autoScale:!1}),(t=this.In-t)<0&&(t=0);let i=(this.Zn+.2*(this.In-1))/(t+.2*(this.In-1));const s=r(this.Vn).clone();i=Math.max(i,.1),s.scaleAroundCenter(i),this.setPriceRange(s)}endScale(){this.isPercentage()||this.isIndexedTo100()||(this.Zn=null,this.Vn=null)}startScroll(t){this.isAutoScale()||null===this.Kn&&null===this.Vn&&(this.isEmpty()||(this.Kn=t,this.Vn=r(this.priceRange()).clone()))}scrollTo(t){if(this.isAutoScale())return;if(null===this.Kn)return;const i=r(this.priceRange()).length()/(this.internalHeight()-1);let s=t-this.Kn;this.isInverted()&&(s*=-1);const e=s*i,n=r(this.Vn).clone();n.shift(e),this.setPriceRange(n,!0),this.Xn=null}endScroll(){this.isAutoScale()||null!==this.Kn&&(this.Kn=null,this.Vn=null)}formatter(){return this.an||this.updateFormatter(),this.an}formatPrice(t,i){switch(this.Gt.mode){case 2:return this.formatter().format(Di(t,i));case 3:return this.formatter().format(Ri(t,i));default:return this.Le(t)}}formatLogical(t){switch(this.Gt.mode){case 2:case 3:return this.formatter().format(t);default:return this.Le(t)}}formatPriceAbsolute(t){return this.Le(t,r(this._h()).formatter())}formatPricePercentage(t,i){return t=Di(t,i),ji.format(t)}sourcesForAutoScale(){return this.qn}recalculatePriceRange(t){this.Fn={zn:t,Wn:!1}}updateAllViews(){this.qn.forEach((t=>t.updateAllViews()))}updateFormatter(){this.Xn=null;const t=this._h();let i=100;null!==t&&(i=Math.round(1/t.minMove())),this.an=Hi,this.isPercentage()?(this.an=ji,i=100):this.isIndexedTo100()?(this.an=new et(100,1),i=100):null!==t&&(this.an=t.formatter()),this.ih=new Fi(this,i,this.sh.bind(this),this.eh.bind(this)),this.ih.An()}invalidateSourcesCache(){this.Yn=null}_h(){return this.qn[0]||null}rh(){return this.isInverted()?this.Gt.scaleMargins.bottom*this.height()+this.Hn:this.Gt.scaleMargins.top*this.height()+this.jn}lh(){return this.isInverted()?this.Gt.scaleMargins.top*this.height()+this.jn:this.Gt.scaleMargins.bottom*this.height()+this.Hn}ah(){this.Fn.Wn||(this.Fn.Wn=!0,this.dh())}nh(){this.Nn=null}eh(t,i){if(this.ah(),this.isEmpty())return 0;t=this.isLog()&&t?Ai(t,this.Gn):t;const s=r(this.priceRange()),e=this.lh()+(this.internalHeight()-1)*(t-s.minValue())/s.length();return this.invertedCoordinate(e)}sh(t,i){if(this.ah(),this.isEmpty())return 0;const s=this.invertedCoordinate(t),e=r(this.priceRange()),n=e.minValue()+e.length()*((s-this.lh())/(this.internalHeight()-1));return this.isLog()?Oi(n,this.Gn):n}hh(){this.Xn=null,this.ih.An()}dh(){const t=this.Fn.zn;if(null===t)return;let i=null;const s=this.sourcesForAutoScale();let e=0,n=0;for(const h of s){if(!h.visible())continue;const s=h.firstValue();if(null===s)continue;const l=h.autoscaleInfo(t.left(),t.right());let a=l&&l.priceRange();if(null!==a){switch(this.Gt.mode){case 1:a=Bi(a,this.Gn);break;case 2:a=Li(a,s.value);break;case 3:a=Ei(a,s.value)}if(i=null===i?a:i.merge(r(a)),null!==l){const t=l.margins();null!==t&&(e=Math.max(e,t.above),n=Math.max(e,t.below))}}}if(e===this.jn&&n===this.Hn||(this.jn=e,this.Hn=n,this.Xn=null,this.nh()),null!==i){if(i.minValue()===i.maxValue()){const t=this._h(),s=5*(null===t||this.isPercentage()||this.isIndexedTo100()?1:t.minMove());this.isLog()&&(i=Ii(i,this.Gn)),i=new ci(i.minValue()-s,i.maxValue()+s),this.isLog()&&(i=Bi(i,this.Gn))}if(this.isLog()){const t=Ii(i,this.Gn),s=Ni(t);if(h=s,l=this.Gn,h.yn!==l.yn||h.kn!==l.kn){const e=null!==this.Vn?Ii(this.Vn,this.Gn):null;this.Gn=s,i=Bi(t,s),null!==e&&(this.Vn=Bi(e,s))}}this.setPriceRange(i)}else null===this.Te&&(this.setPriceRange(new ci(-.5,.5)),this.Gn=Ni(null));var h,l;this.Fn.Wn=!0}oh(){return this.isPercentage()?Di:this.isIndexedTo100()?Ri:this.isLog()?t=>Ai(t,this.Gn):null}Le(t,i){return void 0===this.th.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.th.priceFormatter(t)}}class Ui{constructor(t,i){this.qn=[],this.fh=new Map,this.In=0,this.Ls=0,this.ph=1e3,this.Yn=null,this.mh=new m,this.gh=t,this.Vt=i,this.bh=new Ti(this);const s=i.options();this.wh=this.Mh("left",s.leftPriceScale),this.Sh=this.Mh("right",s.rightPriceScale),this.wh.modeChanged().subscribe(this.yh.bind(this,this.wh),this),this.Sh.modeChanged().subscribe(this.yh.bind(this,this.Sh),this),this.applyScaleOptions(s)}applyScaleOptions(t){if(t.leftPriceScale&&this.wh.applyOptions(t.leftPriceScale),t.rightPriceScale&&this.Sh.applyOptions(t.rightPriceScale),t.localization&&(this.wh.updateFormatter(),this.Sh.updateFormatter()),t.overlayPriceScales){const i=Array.from(this.fh.values());for(const s of i){const i=r(s[0].priceScale());i.applyOptions(t.overlayPriceScales),t.localization&&i.updateFormatter()}}}priceScaleById(t){switch(t){case"left":return this.wh;case"right":return this.Sh}return this.fh.has(t)?h(this.fh.get(t))[0].priceScale():null}destroy(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this.wh.modeChanged().unsubscribeAll(this),this.Sh.modeChanged().unsubscribeAll(this),this.qn.forEach((t=>{t.destroy&&t.destroy()})),this.mh._()}stretchFactor(){return this.ph}setStretchFactor(t){this.ph=t}model(){return this.Vt}width(){return this.Ls}height(){return this.In}setWidth(t){this.Ls=t,this.updateAllSources()}setHeight(t){this.In=t,this.wh.setHeight(t),this.Sh.setHeight(t),this.qn.forEach((i=>{if(this.isOverlay(i)){const s=i.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllSources()}dataSources(){return this.qn}isOverlay(t){const i=t.priceScale();return null===i||this.wh!==i&&this.Sh!==i}addDataSource(t,i,s){const e=void 0!==s?s:this.Ch().kh+1;this.xh(t,i,e)}removeDataSource(t){const i=this.qn.indexOf(t);n(-1!==i,"removeDataSource: invalid data source"),this.qn.splice(i,1);const s=r(t.priceScale()).id();if(this.fh.has(s)){const i=h(this.fh.get(s)),e=i.indexOf(t);-1!==e&&(i.splice(e,1),0===i.length&&this.fh.delete(s))}const e=t.priceScale();e&&e.dataSources().indexOf(t)>=0&&e.removeDataSource(t),null!==e&&(e.invalidateSourcesCache(),this.recalculatePriceScale(e)),this.Yn=null}priceScalePosition(t){return t===this.wh?"left":t===this.Sh?"right":"overlay"}leftPriceScale(){return this.wh}rightPriceScale(){return this.Sh}startScalePrice(t,i){t.startScale(i)}scalePriceTo(t,i){t.scaleTo(i),this.updateAllSources()}endScalePrice(t){t.endScale()}startScrollPrice(t,i){t.startScroll(i)}scrollPriceTo(t,i){t.scrollTo(i),this.updateAllSources()}endScrollPrice(t){t.endScroll()}updateAllSources(){this.qn.forEach((t=>{t.updateAllViews()}))}defaultPriceScale(){let t=null;return this.Vt.options().rightPriceScale.visible&&0!==this.Sh.dataSources().length?t=this.Sh:this.Vt.options().leftPriceScale.visible&&0!==this.wh.dataSources().length?t=this.wh:0!==this.qn.length&&(t=this.qn[0].priceScale()),null===t&&(t=this.Sh),t}defaultVisiblePriceScale(){let t=null;return this.Vt.options().rightPriceScale.visible?t=this.Sh:this.Vt.options().leftPriceScale.visible&&(t=this.wh),t}recalculatePriceScale(t){null!==t&&t.isAutoScale()&&this.Th(t)}resetPriceScale(t){const i=this.gh.visibleStrictRange();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllSources()}momentaryAutoScale(){this.Th(this.wh),this.Th(this.Sh)}recalculate(){this.recalculatePriceScale(this.wh),this.recalculatePriceScale(this.Sh),this.qn.forEach((t=>{this.isOverlay(t)&&this.recalculatePriceScale(t.priceScale())})),this.updateAllSources(),this.Vt.lightUpdate()}orderedSources(){return null===this.Yn&&(this.Yn=Wi(this.qn)),this.Yn}onDestroyed(){return this.mh}grid(){return this.bh}Th(t){const i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.gh.isEmpty()){const i=this.gh.visibleStrictRange();null!==i&&t.recalculatePriceRange(i)}t.updateAllViews()}Ch(){const t=this.orderedSources();if(0===t.length)return{Ph:0,kh:0};let i=0,s=0;for(let e=0;e<t.length;e++){const n=t[e].zorder();null!==n&&(n<i&&(i=n),n>s&&(s=n))}return{Ph:i,kh:s}}xh(t,i,s){let e=this.priceScaleById(i);if(null===e&&(e=this.Mh(i,this.Vt.options().overlayPriceScales)),this.qn.push(t),!Q(i)){const s=this.fh.get(i)||[];s.push(t),this.fh.set(i,s)}e.addDataSource(t),t.setPriceScale(e),t.setZorder(s),this.recalculatePriceScale(e),this.Yn=null}yh(t,i,s){i.mode!==s.mode&&this.Th(t)}Mh(t,i){const s=Object.assign({visible:!0,autoScale:!0},y(i)),e=new $i(t,s,this.Vt.options().layout,this.Vt.options().localization);return e.setHeight(this.height()),e}}const qi=t=>t.getUTCFullYear();function Yi(t,i,s){return i.replace(/yyyy/g,(t=>st(qi(t),4))(t)).replace(/yy/g,(t=>st(qi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>st((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>st((t=>t.getUTCDate())(t),2))(t))}class Xi{constructor(t="yyyy-MM-dd",i="default"){this.Dh=t,this.Lh=i}Rh(t){return Yi(t,this.Dh,this.Lh)}}class Zi{constructor(t){this.Eh=t||"%h:%m:%s"}Rh(t){return this.Eh.replace("%h",st(t.getUTCHours(),2)).replace("%m",st(t.getUTCMinutes(),2)).replace("%s",st(t.getUTCSeconds(),2))}}const Ki={Ah:"yyyy-MM-dd",Oh:"%h:%m:%s",Bh:" ",Ih:"default"};class Gi{constructor(t={}){const i=Object.assign(Object.assign({},Ki),t);this.Nh=new Xi(i.Ah,i.Ih),this.Vh=new Zi(i.Oh),this.Fh=i.Bh}Rh(t){return`${this.Nh.Rh(t)}${this.Fh}${this.Vh.Rh(t)}`}}class Ji{constructor(t,i=50){this.bs=0,this.ws=1,this.Ms=1,this.ys=new Map,this.Ss=new Map,this.Wh=t,this.ks=i}Rh(t){const i=t.Ft,s=void 0===i.businessDay?new Date(1e3*i.timestamp).getTime():new Date(Date.UTC(i.businessDay.year,i.businessDay.month-1,i.businessDay.day)).getTime(),e=this.ys.get(s);if(void 0!==e)return e.zh;if(this.bs===this.ks){const t=this.Ss.get(this.Ms);this.Ss.delete(this.Ms),this.ys.delete(h(t)),this.Ms++,this.bs--}const n=this.Wh(t);return this.ys.set(s,{zh:n,Ts:this.ws}),this.Ss.set(this.ws,s),this.bs++,this.ws++,n}}class Qi{constructor(t,i){n(t<=i,"right should be >= left"),this.jh=t,this.Hh=i}left(){return this.jh}right(){return this.Hh}count(){return this.Hh-this.jh+1}contains(t){return this.jh<=t&&t<=this.Hh}equals(t){return this.jh===t.left()&&this.Hh===t.right()}}function ts(t,i){return null===t||null===i?t===i:t.equals(i)}class is{constructor(){this.$h=new Map,this.ys=null}Uh(t,i){this.qh(i),this.ys=null;for(let s=i;s<t.length;++s){const i=t[s];let e=this.$h.get(i.timeWeight);void 0===e&&(e=[],this.$h.set(i.timeWeight,e)),e.push({Yh:s,Ft:i.time,Xh:i.timeWeight,Zh:i.originalTime})}}Kh(t,i){const s=Math.ceil(i/t);return null!==this.ys&&this.ys.Gh===s||(this.ys={Bn:this.Jh(s),Gh:s}),this.ys.Bn}qh(t){if(0===t)return void this.$h.clear();const i=[];this.$h.forEach(((s,e)=>{t<=s[0].Yh?i.push(e):s.splice(vt(s,t,(i=>i.Yh<t)),1/0)}));for(const t of i)this.$h.delete(t)}Jh(t){let i=[];for(const s of Array.from(this.$h.keys()).sort(((t,i)=>i-t))){if(!this.$h.get(s))continue;const e=i;i=[];const n=e.length;let r=0;const l=h(this.$h.get(s)),a=l.length;let o=1/0,u=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.Yh;for(;r<n;){const t=e[r],s=t.Yh;if(!(s<a)){o=s;break}r++,i.push(t),u=s,o=1/0}o-a>=t&&a-u>=t&&(i.push(h),u=a)}for(;r<n;r++)i.push(e[r])}return i}}class ss{constructor(t){this.Qh=t}tr(){return null===this.Qh?null:new Qi(Math.floor(this.Qh.left()),Math.ceil(this.Qh.right()))}ir(){return this.Qh}static sr(){return new ss(null)}}var es,ns,hs,rs,ls;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(es||(es={}));class as{constructor(t,i,s){this.Ls=0,this.er=null,this.nr=[],this.Kn=null,this.Zn=null,this.hr=new is,this.rr=new Map,this.lr=ss.sr(),this.ar=!0,this.ur=new m,this.cr=new m,this._r=new m,this.dr=null,this.pr=null,this.vr=[],this.Gt=i,this.th=s,this.mr=i.rightOffset,this.gr=i.barSpacing,this.Vt=t,this.br()}options(){return this.Gt}applyLocalizationOptions(t){g(this.th,t),this.wr(),this.br()}applyOptions(t,i){var s;g(this.Gt,t),this.Gt.fixLeftEdge&&this.Mr(),this.Gt.fixRightEdge&&this.Sr(),void 0!==t.barSpacing&&this.Vt.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this.Vt.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this.Vt.setBarSpacing(null!==(s=t.barSpacing)&&void 0!==s?s:this.gr),this.wr(),this.br(),this._r._()}indexToTime(t){var i,s;return null!==(s=null===(i=this.nr[t])||void 0===i?void 0:i.time)&&void 0!==s?s:null}indexToTimeScalePoint(t){var i;return null!==(i=this.nr[t])&&void 0!==i?i:null}timeToIndex(t,i){if(this.nr.length<1)return null;if(t.timestamp>this.nr[this.nr.length-1].time.timestamp)return i?this.nr.length-1:null;const s=vt(this.nr,t.timestamp,((t,i)=>t.time.timestamp<i));return t.timestamp<this.nr[s].time.timestamp?i?s:null:s}isEmpty(){return 0===this.Ls||0===this.nr.length||null===this.er}visibleStrictRange(){return this.yr(),this.lr.tr()}visibleLogicalRange(){return this.yr(),this.lr.ir()}visibleTimeRange(){const t=this.visibleStrictRange();if(null===t)return null;const i={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(i)}timeRangeForLogicalRange(t){const i=Math.round(t.from),s=Math.round(t.to),e=r(this.kr()),n=r(this.Cr());return{from:r(this.indexToTime(Math.max(e,i))),to:r(this.indexToTime(Math.min(n,s)))}}logicalRangeForTimeRange(t){return{from:r(this.timeToIndex(t.from,!0)),to:r(this.timeToIndex(t.to,!0))}}width(){return this.Ls}setWidth(t){if(!isFinite(t)||t<=0)return;if(this.Ls===t)return;const i=this.visibleLogicalRange(),s=this.Ls;if(this.Ls=t,this.ar=!0,this.Gt.lockVisibleTimeRangeOnResize&&0!==s){const i=this.gr*t/s;this.gr=i}if(this.Gt.fixLeftEdge&&null!==i&&i.left()<=0){const i=s-t;this.mr-=Math.round(i/this.gr)+1,this.ar=!0}this.Tr(),this.Pr()}indexToCoordinate(t){if(this.isEmpty()||!w(t))return 0;const i=this.baseIndex()+this.mr-t;return this.Ls-(i+.5)*this.gr-1}indexesToCoordinates(t,i){const s=this.baseIndex(),e=void 0===i?0:i.from,n=void 0===i?t.length:i.to;for(let i=e;i<n;i++){const e=t[i].time,n=s+this.mr-e,h=this.Ls-(n+.5)*this.gr-1;t[i].x=h}}coordinateToIndex(t){return Math.ceil(this.Dr(t))}setRightOffset(t){this.ar=!0,this.mr=t,this.Pr(),this.Vt.recalculateAllPanes(),this.Vt.lightUpdate()}barSpacing(){return this.gr}setBarSpacing(t){this.Lr(t),this.Pr(),this.Vt.recalculateAllPanes(),this.Vt.lightUpdate()}rightOffset(){return this.mr}marks(){if(this.isEmpty())return null;if(null!==this.pr)return this.pr;const t=this.gr,i=5*(this.Vt.options().layout.fontSize+4),s=Math.round(i/t),e=r(this.visibleStrictRange()),n=Math.max(e.left(),e.left()-s),h=Math.max(e.right(),e.right()-s),l=this.hr.Kh(t,i),a=this.kr()+s,o=this.Cr()-s,u=this.Rr(),c=this.Gt.fixLeftEdge||u,_=this.Gt.fixRightEdge||u;let d=0;for(const t of l){if(!(n<=t.Yh&&t.Yh<=h))continue;let s;d<this.vr.length?(s=this.vr[d],s.coord=this.indexToCoordinate(t.Yh),s.label=this.Er(t),s.weight=t.Xh):(s={needAlignCoordinate:!1,coord:this.indexToCoordinate(t.Yh),label:this.Er(t),weight:t.Xh},this.vr.push(s)),this.gr>i/2&&!u?s.needAlignCoordinate=!1:s.needAlignCoordinate=c&&t.Yh<=a||_&&t.Yh>=o,d++}return this.vr.length=d,this.pr=this.vr,this.vr}restoreDefault(){this.ar=!0,this.setBarSpacing(this.Gt.barSpacing),this.setRightOffset(this.Gt.rightOffset)}setBaseIndex(t){this.ar=!0,this.er=t,this.Pr(),this.Mr()}zoom(t,i){const s=this.Dr(t),e=this.barSpacing(),n=e+i*(e/10);this.setBarSpacing(n),this.Gt.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(s-this.Dr(t)))}startScale(t){this.Kn&&this.endScroll(),null===this.Zn&&null===this.dr&&(this.isEmpty()||(this.Zn=t,this.Ar()))}scaleTo(t){if(null===this.dr)return;const i=Tt(this.Ls-t,0,this.Ls),s=Tt(this.Ls-r(this.Zn),0,this.Ls);0!==i&&0!==s&&this.setBarSpacing(this.dr.Ki*i/s)}endScale(){null!==this.Zn&&(this.Zn=null,this.Or())}startScroll(t){null===this.Kn&&null===this.dr&&(this.isEmpty()||(this.Kn=t,this.Ar()))}scrollTo(t){if(null===this.Kn)return;const i=(this.Kn-t)/this.barSpacing();this.mr=r(this.dr).Br+i,this.ar=!0,this.Pr()}endScroll(){null!==this.Kn&&(this.Kn=null,this.Or())}scrollToRealTime(){this.scrollToOffsetAnimated(this.Gt.rightOffset)}scrollToOffsetAnimated(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.mr,e=performance.now();this.Vt.setTimeScaleAnimation({finished:t=>(t-e)/i>=1,getPosition:n=>{const h=(n-e)/i;return h>=1?t:s+(t-s)*h}})}update(t,i){this.ar=!0,this.nr=t,this.hr.Uh(t,i),this.Pr()}visibleBarsChanged(){return this.ur}logicalRangeChanged(){return this.cr}optionsApplied(){return this._r}baseIndex(){return this.er||0}setVisibleRange(t){const i=t.count();this.Lr(this.Ls/i),this.mr=t.right()-this.baseIndex(),this.Pr(),this.ar=!0,this.Vt.recalculateAllPanes(),this.Vt.lightUpdate()}fitContent(){const t=this.kr(),i=this.Cr();null!==t&&null!==i&&this.setVisibleRange(new Qi(t,i+this.Gt.rightOffset))}setLogicalRange(t){const i=new Qi(t.from,t.to);this.setVisibleRange(i)}formatDateTime(t){return void 0!==this.th.timeFormatter?this.th.timeFormatter(t.originalTime):this.Ir.Rh(new Date(1e3*t.time.timestamp))}Rr(){const{handleScroll:t,handleScale:i}=this.Vt.options();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}kr(){return 0===this.nr.length?null:0}Cr(){return 0===this.nr.length?null:this.nr.length-1}Nr(t){return(this.Ls-1-t)/this.gr}Dr(t){const i=this.Nr(t),s=this.baseIndex()+this.mr-i;return Math.round(1e6*s)/1e6}Lr(t){const i=this.gr;this.gr=t,this.Tr(),i!==this.gr&&(this.ar=!0,this.Vr())}yr(){if(!this.ar)return;if(this.ar=!1,this.isEmpty())return void this.Fr(ss.sr());const t=this.baseIndex(),i=this.Ls/this.gr,s=this.mr+t,e=new Qi(s-i+1,s);this.Fr(new ss(e))}Tr(){const t=this.Wr();if(this.gr<t&&(this.gr=t,this.ar=!0),0!==this.Ls){const t=.5*this.Ls;this.gr>t&&(this.gr=t,this.ar=!0)}}Wr(){return this.Gt.fixLeftEdge&&this.Gt.fixRightEdge&&0!==this.nr.length?this.Ls/this.nr.length:this.Gt.minBarSpacing}Pr(){const t=this.zr();this.mr>t&&(this.mr=t,this.ar=!0);const i=this.jr();null!==i&&this.mr<i&&(this.mr=i,this.ar=!0)}jr(){const t=this.kr(),i=this.er;if(null===t||null===i)return null;return t-i-1+(this.Gt.fixLeftEdge?this.Ls/this.gr:Math.min(2,this.nr.length))}zr(){return this.Gt.fixRightEdge?0:this.Ls/this.gr-Math.min(2,this.nr.length)}Ar(){this.dr={Ki:this.barSpacing(),Br:this.rightOffset()}}Or(){this.dr=null}Er(t){let i=this.rr.get(t.Xh);return void 0===i&&(i=new Ji((t=>this.Hr(t))),this.rr.set(t.Xh,i)),i.Rh(t)}Hr(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.Xh,this.Gt.timeVisible,this.Gt.secondsVisible);return void 0!==this.Gt.tickMarkFormatter?this.Gt.tickMarkFormatter(t.Zh,i,this.th.locale):function(t,i,s){const e={};switch(i){case 0:e.year="numeric";break;case 1:e.month="short";break;case 2:e.day="numeric";break;case 3:e.hour12=!1,e.hour="2-digit",e.minute="2-digit";break;case 4:e.hour12=!1,e.hour="2-digit",e.minute="2-digit",e.second="2-digit"}const n=void 0===t.businessDay?new Date(1e3*t.timestamp):new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()).toLocaleString(s,e)}(t.Ft,i,this.th.locale)}Fr(t){const i=this.lr;this.lr=t,ts(i.tr(),this.lr.tr())||this.ur._(),ts(i.ir(),this.lr.ir())||this.cr._(),this.Vr()}Vr(){this.pr=null}wr(){this.Vr(),this.rr.clear()}br(){const t=this.th.dateFormat;this.Gt.timeVisible?this.Ir=new Gi({Ah:t,Oh:this.Gt.secondsVisible?"%h:%m:%s":"%h:%m",Bh:"   ",Ih:this.th.locale}):this.Ir=new Xi(t,this.th.locale)}Mr(){if(!this.Gt.fixLeftEdge)return;const t=this.kr();if(null===t)return;const i=this.visibleStrictRange();if(null===i)return;const s=i.left()-t;if(s<0){const t=this.mr-s-1;this.setRightOffset(t)}this.Tr()}Sr(){this.Pr(),this.Tr()}}class os extends L{constructor(t){super(),this.$r=new Map,this.Y=t}D(t){}L(t){if(!this.Y.X)return;t.save();let i=0;for(const s of this.Y.Ur){if(0===s._e.length)continue;t.font=s.qr;const e=this.Yr(t,s._e);e>this.Y.Ns?s.Xr=this.Y.Ns/e:s.Xr=1,i+=s.Zr*s.Xr}let s=0;switch(this.Y.Kr){case"top":s=0;break;case"center":s=Math.max((this.Y.Is-i)/2,0);break;case"bottom":s=Math.max(this.Y.Is-i,0)}t.fillStyle=this.Y.st;for(const i of this.Y.Ur){t.save();let e=0;switch(this.Y.Gr){case"left":t.textAlign="left",e=i.Zr/2;break;case"center":t.textAlign="center",e=this.Y.Ns/2;break;case"right":t.textAlign="right",e=this.Y.Ns-1-i.Zr/2}t.translate(e,s),t.textBaseline="top",t.font=i.qr,t.scale(i.Xr,i.Xr),t.fillText(i._e,0,i.Jr),t.restore(),s+=i.Zr*i.Xr}t.restore()}Yr(t,i){const s=this.Qr(t.font);let e=s.get(i);return void 0===e&&(e=t.measureText(i).width,s.set(i,e)),e}Qr(t){let i=this.$r.get(t);return void 0===i&&(i=new Map,this.$r.set(t,i)),i}}class us{constructor(t){this.$=!0,this.nt={X:!1,st:"",Is:0,Ns:0,Ur:[],Kr:"center",Gr:"center"},this.ht=new os(this.nt),this.rt=t}update(){this.$=!0}renderer(t,i){return this.$&&(this.q(t,i),this.$=!1),this.ht}q(t,i){const s=this.rt.options(),e=this.nt;e.X=s.visible,e.X&&(e.st=s.color,e.Ns=i,e.Is=t,e.Gr=s.horzAlign,e.Kr=s.vertAlign,e.Ur=[{_e:s.text,qr:T(s.fontSize,s.fontFamily,s.fontStyle),Zr:1.2*s.fontSize,Jr:0,Xr:0}])}}class cs extends K{constructor(t,i){super(),this.Gt=i,this.ii=new us(this)}priceAxisViews(){return[]}paneViews(){return[this.ii]}options(){return this.Gt}updateAllViews(){this.ii.update()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(ns||(ns={}));class _s{constructor(t,i){this.tl=[],this.il=[],this.Ls=0,this.sl=null,this.el=new m,this.nl=new m,this.hl=new m,this.rl=null,this.ll=t,this.Gt=i,this.al=new P(this),this.gh=new as(this,i.timeScale,this.Gt.localization),this.U=new J(this,i.crosshair),this.ol=new ki(i.crosshair),this.ul=new cs(this,i.watermark),this.createPane(),this.tl[0].setStretchFactor(2e3),this.cl=this._l(0),this.dl=this._l(1)}customPriceLineDragged(){return this.hl}fullUpdate(){this.fl(tt.full())}lightUpdate(){this.fl(tt.light())}cursorUpdate(){this.fl(new tt(1))}updateSource(t){const i=this.pl(t);this.fl(i)}hoveredSource(){return this.sl}setHoveredSource(t){const i=this.sl;this.sl=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)}options(){return this.Gt}applyOptions(t){g(this.Gt,t),this.tl.forEach((i=>i.applyScaleOptions(t))),void 0!==t.timeScale&&this.gh.applyOptions(t.timeScale),void 0!==t.localization&&this.gh.applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.el._(),this.cl=this._l(0),this.dl=this._l(1),this.fullUpdate()}applyPriceScaleOptions(t,i){if("left"===t)return void this.applyOptions({leftPriceScale:i});if("right"===t)return void this.applyOptions({rightPriceScale:i});const s=this.findPriceScale(t);null!==s&&(s.priceScale.applyOptions(i),this.el._())}findPriceScale(t){for(const i of this.tl){const s=i.priceScaleById(t);if(null!==s)return{pane:i,priceScale:s}}return null}timeScale(){return this.gh}panes(){return this.tl}watermarkSource(){return this.ul}crosshairSource(){return this.U}crosshairMoved(){return this.nl}setPaneHeight(t,i){t.setHeight(i),this.recalculateAllPanes()}fireCustomPriceLineDragged(t,i){this.hl._(t,i)}setWidth(t){this.Ls=t,this.gh.setWidth(this.Ls),this.tl.forEach((i=>i.setWidth(t))),this.recalculateAllPanes()}setAndSaveCurrentPositionFire(t,i,s,e){this.U.saveOriginCoord(t,i);let n=NaN,h=this.gh.coordinateToIndex(t);const r=this.gh.visibleStrictRange();null!==r&&(h=Math.min(Math.max(r.left(),h),r.right()));const l=e.defaultPriceScale(),a=l.firstValue();null!==a&&(n=l.coordinateToPrice(i,a)),n=this.ol.dn(n,h,e),this.U.setPosition(h,n,e),this.cursorUpdate(),s&&this.nl._(this.U.appliedIndex(),null)}createPane(t){const i=new Ui(this.gh,this);void 0!==t?this.tl.splice(t,0,i):this.tl.push(i);const s=void 0===t?this.tl.length-1:t,e=tt.full();return e.invalidatePane(s,{level:0,autoScale:!0}),this.fl(e),i}startScalePrice(t,i,s){t.startScalePrice(i,s)}scalePriceTo(t,i,s){t.scalePriceTo(i,s),this.updateCrosshair(),this.fl(this.vl(t,2))}endScalePrice(t,i){t.endScalePrice(i),this.fl(this.vl(t,2))}startScrollPrice(t,i,s){i.isAutoScale()||t.startScrollPrice(i,s)}scrollPriceTo(t,i,s){i.isAutoScale()||(t.scrollPriceTo(i,s),this.updateCrosshair(),this.fl(this.vl(t,2)))}endScrollPrice(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.fl(this.vl(t,2)))}resetPriceScale(t,i){t.resetPriceScale(i),this.fl(this.vl(t,2))}startScaleTime(t){this.gh.startScale(t)}zoomTime(t,i){const s=this.timeScale();if(s.isEmpty()||0===i)return;const e=s.width();t=Math.max(1,Math.min(t,e)),s.zoom(t,i),this.recalculateAllPanes()}scrollChart(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()}scaleTimeTo(t){this.gh.scaleTo(t),this.recalculateAllPanes()}endScaleTime(){this.gh.endScale(),this.lightUpdate()}startScrollTime(t){this.gh.startScroll(t)}scrollTimeTo(t){this.gh.scrollTo(t),this.recalculateAllPanes()}endScrollTime(){this.gh.endScroll(),this.lightUpdate()}serieses(){return this.il}setAndSaveCurrentPosition(t,i,s,e){this.U.saveOriginCoord(t,i);let n=NaN,h=this.gh.coordinateToIndex(t);const r=this.gh.visibleStrictRange();null!==r&&(h=Math.min(Math.max(r.left(),h),r.right()));const l=e.defaultPriceScale(),a=l.firstValue();null!==a&&(n=l.coordinateToPrice(i,a)),n=this.ol.dn(n,h,e),this.U.setPosition(h,n,e),this.cursorUpdate(),this.nl._(this.U.appliedIndex(),s)}clearCurrentPosition(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this.nl._(null,null)}updateCrosshair(){const t=this.U.pane();if(null!==t){const i=this.U.originCoordX(),s=this.U.originCoordY();this.setAndSaveCurrentPosition(i,s,null,t)}this.U.updateAllViews()}updateTimeScale(t,i,s){const e=this.gh.indexToTime(0);void 0!==i&&void 0!==s&&this.gh.update(i,s);const n=this.gh.indexToTime(0),h=this.gh.baseIndex(),r=this.gh.visibleStrictRange();if(null!==r&&null!==e&&null!==n){const i=r.contains(h),s=e.timestamp>n.timestamp,l=null!==t&&t>h&&!s,a=i&&this.gh.options().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-h;this.gh.setRightOffset(this.gh.rightOffset()-i)}}this.gh.setBaseIndex(t)}recalculatePane(t){null!==t&&t.recalculate()}paneForSource(t){const i=this.tl.find((i=>i.orderedSources().includes(t)));return void 0===i?null:i}recalculateAllPanes(){this.ul.updateAllViews(),this.tl.forEach((t=>t.recalculate())),this.updateCrosshair()}destroy(){this.tl.forEach((t=>t.destroy())),this.tl.length=0,this.Gt.localization.priceFormatter=void 0,this.Gt.localization.timeFormatter=void 0}rendererOptionsProvider(){return this.al}priceAxisRendererOptions(){return this.al.options()}priceScalesOptionsChanged(){return this.el}createSeries(t,i){const s=this.tl[0],e=this.ml(i,t,s);return this.il.push(e),1===this.il.length?this.fullUpdate():this.lightUpdate(),e}removeSeries(t){const i=this.paneForSource(t),s=this.il.indexOf(t);n(-1!==s,"Series not found"),this.il.splice(s,1),r(i).removeDataSource(t),t.destroy&&t.destroy()}moveSeriesToScale(t,i){const s=r(this.paneForSource(t));s.removeDataSource(t);const e=this.findPriceScale(i);if(null===e){const e=t.zorder();s.addDataSource(t,i,e)}else{const n=e.pane===s?t.zorder():void 0;e.pane.addDataSource(t,i,n)}}fitContent(){const t=tt.light();t.setFitContent(),this.fl(t)}setTargetLogicalRange(t){const i=tt.light();i.applyRange(t),this.fl(i)}resetTimeScale(){const t=tt.light();t.resetTimeScale(),this.fl(t)}setBarSpacing(t){const i=tt.light();i.setBarSpacing(t),this.fl(i)}setRightOffset(t){const i=tt.light();i.setRightOffset(t),this.fl(i)}setTimeScaleAnimation(t){const i=tt.light();i.setTimeScaleAnimation(t),this.fl(i)}stopTimeScaleAnimation(){const t=tt.light();t.stopTimeScaleAnimation(),this.fl(t)}defaultVisiblePriceScaleId(){return this.Gt.rightPriceScale.visible?"right":"left"}backgroundBottomColor(){return this.dl}backgroundTopColor(){return this.cl}backgroundColorAtYPercentFromTop(t){const i=this.dl,s=this.cl;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.rl||this.rl.gl!==s||this.rl.bl!==i)this.rl={gl:s,bl:i,wl:new Map};else{const i=this.rl.wl.get(t);if(void 0!==i)return i}const e=function(t,i,s){const[e,n,h,r]=p(t),[l,a,c,_]=p(i),d=[o(e+s*(l-e)),o(n+s*(a-n)),o(h+s*(c-h)),u(r+s*(_-r))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.rl.wl.set(t,e),e}vl(t,i){const s=new tt(i);if(null!==t){const e=this.tl.indexOf(t);s.invalidatePane(e,{level:i})}return s}pl(t,i){return void 0===i&&(i=2),this.vl(this.paneForSource(t),i)}fl(t){this.ll&&this.ll(t),this.tl.forEach((t=>t.grid().paneView().update()))}ml(t,i,s){const e=new yi(this,t,i),n=void 0!==t.priceScaleId?t.priceScaleId:this.defaultVisiblePriceScaleId();return s.addDataSource(e,n),Q(n)||e.applyOptions(t),e}_l(t){const i=this.Gt.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function ds(t){return!b(t)&&!M(t)}function fs(t){return b(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(hs||(hs={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(rs||(rs={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(ls||(ls={}));const ps="undefined"!=typeof window;function vs(){return!!ps&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ms(){return!!ps&&/iPhone|iPad|iPod/.test(window.navigator.platform)}var gs={allowDownsampling:!0};var bs=function(){function t(t,i){var s=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return s._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=i,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}();class ws{constructor(t,i){this.tt=t,this.it=i}Ml(t){return this.tt===t.tt&&this.it===t.it}}function Ms(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function Ss(t){const i=r(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function ys(t,i){const s=r(t.ownerDocument).createElement("canvas");t.appendChild(s);const e=function(t,i){return void 0===i&&(i=gs),new bs(t,i)}(s,{allowDownsampling:!1});return e.resizeCanvas({width:i.tt,height:i.it}),e}function ks(t,i){return t.Sl-i.Sl}function Cs(t,i,s){const e=(t.Sl-i.Sl)/(t.Ft-i.Ft);return Math.sign(e)*Math.min(Math.abs(e),s)}class xs{constructor(t,i,s,e){this.yl=null,this.kl=null,this.Cl=null,this.xl=null,this.Tl=null,this.Pl=0,this.Dl=0,this.Ll=t,this.Rl=i,this.El=s,this._i=e}Al(t,i){if(null!==this.yl){if(this.yl.Ft===i)return void(this.yl.Sl=t);if(Math.abs(this.yl.Sl-t)<this._i)return}this.xl=this.Cl,this.Cl=this.kl,this.kl=this.yl,this.yl={Ft:i,Sl:t}}qs(t,i){if(null===this.yl||null===this.kl)return;if(i-this.yl.Ft>50)return;let s=0;const e=Cs(this.yl,this.kl,this.Rl),n=ks(this.yl,this.kl),h=[e],r=[n];if(s+=n,null!==this.Cl){const t=Cs(this.kl,this.Cl,this.Rl);if(Math.sign(t)===Math.sign(e)){const i=ks(this.kl,this.Cl);if(h.push(t),r.push(i),s+=i,null!==this.xl){const t=Cs(this.Cl,this.xl,this.Rl);if(Math.sign(t)===Math.sign(e)){const i=ks(this.Cl,this.xl);h.push(t),r.push(i),s+=i}}}}let l=0;for(let t=0;t<h.length;++t)l+=r[t]/s*h[t];Math.abs(l)<this.Ll||(this.Tl={Sl:t,Ft:i},this.Dl=l,this.Pl=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.El))}Ol(t){const i=r(this.Tl),s=t-i.Ft;return i.Sl+this.Dl*(Math.pow(this.El,s)-1)/Math.log(this.El)}Bl(t){return null===this.Tl||this.Il(t)===this.Pl}Il(t){const i=t-r(this.Tl).Ft;return Math.min(i,this.Pl)}}function Ts(t){ps&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Ps{constructor(t,i,s){this.Nl=0,this.Vl=null,this.Fl={G:Number.NEGATIVE_INFINITY,J:Number.POSITIVE_INFINITY},this.Wl=0,this.zl=null,this.jl={G:Number.NEGATIVE_INFINITY,J:Number.POSITIVE_INFINITY},this.Hl=null,this.$l=!1,this.Ul=null,this.ql=null,this.Yl=!1,this.Xl=!1,this.Zl=!1,this.Kl=null,this.Gl=null,this.Jl=null,this.Ql=null,this.ta=null,this.ia=null,this.sa=null,this.ea=0,this.na=!1,this.ha=!1,this.ra=!1,this.la=0,this.aa=null,this.oa=!ms(),this.ua=t=>{this.ca(t)},this._a=t=>{if(this.da(t)){const i=this.fa(t);if(++this.Wl,this.zl&&this.Wl>1){const{pa:s}=this.va(Rs(t),this.jl);s<30&&!this.Zl&&this.ma(i,this.ba.ga),this.wa()}}else{const i=this.fa(t);if(++this.Nl,this.Vl&&this.Nl>1){const{pa:s}=this.va(Rs(t),this.Fl);s<5&&!this.Xl&&this.Ma(i,this.ba.Sa),this.ya()}}},this.ka=t,this.ba=i,this.Gt=s,this.Ca()}destroy(){null!==this.Kl&&(this.Kl(),this.Kl=null),null!==this.Gl&&(this.Gl(),this.Gl=null),null!==this.Ql&&(this.Ql(),this.Ql=null),null!==this.ta&&(this.ta(),this.ta=null),null!==this.ia&&(this.ia(),this.ia=null),null!==this.Jl&&(this.Jl(),this.Jl=null),this.xa(),this.ya()}Ta(t){this.Ql&&this.Ql();const i=this.Pa.bind(this);if(this.Ql=()=>{this.ka.removeEventListener("mousemove",i)},this.ka.addEventListener("mousemove",i),this.da(t))return;const s=this.fa(t);this.Ma(s,this.ba.Da),this.oa=!0}ya(){null!==this.Vl&&clearTimeout(this.Vl),this.Nl=0,this.Vl=null,this.Fl={G:Number.NEGATIVE_INFINITY,J:Number.POSITIVE_INFINITY}}wa(){null!==this.zl&&clearTimeout(this.zl),this.Wl=0,this.zl=null,this.jl={G:Number.NEGATIVE_INFINITY,J:Number.POSITIVE_INFINITY}}Pa(t){if(this.ra||null!==this.ql)return;if(this.da(t))return;const i=this.fa(t);this.Ma(i,this.ba.La),this.oa=!0}Ra(t){const i=As(t.changedTouches,r(this.aa));if(null===i)return;if(this.la=Es(t),null!==this.sa)return;if(this.ha)return;this.na=!0;const s=this.va(Rs(i),r(this.ql)),{Ea:e,Aa:n,pa:h}=s;if(this.Yl||!(h<5)){if(!this.Yl){const t=.5*e,i=n>=t&&!this.Gt.Oa(),s=t>n&&!this.Gt.Ba();i||s||(this.ha=!0),this.Yl=!0,this.Zl=!0,this.xa(),this.wa()}if(!this.ha){const s=this.fa(t,i);this.ma(s,this.ba.Ia),Ls(t)}}}Na(t){if(0!==t.button)return;const i=this.va(Rs(t),r(this.Ul)),{pa:s}=i;if(s>=5&&(this.Xl=!0,this.ya()),this.Xl){const i=this.fa(t);this.Ma(i,this.ba.Va)}}va(t,i){const s=Math.abs(i.G-t.G),e=Math.abs(i.J-t.J);return{Ea:s,Aa:e,pa:s+e}}Fa(t){let i=As(t.changedTouches,r(this.aa));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.aa=null,this.la=Es(t),this.xa(),this.ql=null,this.ia&&(this.ia(),this.ia=null);const s=this.fa(t,i);if(this.ma(s,this.ba.Wa),++this.Wl,this.zl&&this.Wl>1){const{pa:t}=this.va(Rs(i),this.jl);t<30&&!this.Zl&&this.ma(s,this.ba.ga),this.wa()}else this.Zl||(this.ma(s,this.ba.za),this.ba.za&&Ls(t));0===this.Wl&&Ls(t),0===t.touches.length&&this.$l&&(this.$l=!1,Ls(t))}ca(t){if(0!==t.button)return;const i=this.fa(t);if(this.Ul=null,this.ra=!1,this.ta&&(this.ta(),this.ta=null),vs()){this.ka.ownerDocument.documentElement.removeEventListener("mouseleave",this.ua)}if(!this.da(t))if(this.Ma(i,this.ba.ja),++this.Nl,this.Vl&&this.Nl>1){const{pa:s}=this.va(Rs(t),this.Fl);s<5&&!this.Xl&&this.Ma(i,this.ba.Sa),this.ya()}else this.Xl||this.Ma(i,this.ba.Ha)}xa(){null!==this.Hl&&(clearTimeout(this.Hl),this.Hl=null)}$a(t){if(null!==this.aa)return;const i=t.changedTouches[0];this.aa=i.identifier,this.la=Es(t);const s=this.ka.ownerDocument.documentElement;this.Zl=!1,this.Yl=!1,this.ha=!1,this.ql=Rs(i),this.ia&&(this.ia(),this.ia=null);{const i=this.Ra.bind(this),e=this.Fa.bind(this);this.ia=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",e)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",e,{passive:!1}),this.xa(),this.Hl=setTimeout(this.Ua.bind(this,t),240)}const e=this.fa(t,i);this.ma(e,this.ba.qa),this.zl||(this.Wl=0,this.zl=setTimeout(this.wa.bind(this),500),this.jl=Rs(i))}Ya(t){if(0!==t.button)return;const i=this.ka.ownerDocument.documentElement;vs()&&i.addEventListener("mouseleave",this.ua),this.Xl=!1,this.Ul=Rs(t),this.ta&&(this.ta(),this.ta=null);{const t=this.Na.bind(this),s=this.ca.bind(this);this.ta=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.ra=!0,this.da(t))return;const s=this.fa(t);this.Ma(s,this.ba.Xa),this.Vl||(this.Nl=0,this.Vl=setTimeout(this.ya.bind(this),500),this.Fl=Rs(t))}Ca(){this.ka.addEventListener("mouseenter",this.Ta.bind(this)),this.ka.addEventListener("touchcancel",this.xa.bind(this));{const t=this.ka.ownerDocument,i=t=>{this.ba.Za&&(t.composed&&this.ka.contains(t.composedPath()[0])||t.target&&this.ka.contains(t.target)||this.ba.Za())};this.Gl=()=>{t.removeEventListener("touchstart",i)},this.Kl=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ms()&&(this.Jl=()=>{this.ka.removeEventListener("dblclick",this._a)},this.ka.addEventListener("dblclick",this._a)),this.ka.addEventListener("mouseleave",this.Ka.bind(this)),this.ka.addEventListener("touchstart",this.$a.bind(this),{passive:!0}),Ts(this.ka),this.ka.addEventListener("mousedown",this.Ya.bind(this)),this.Ga(),this.ka.addEventListener("touchmove",(()=>{}),{passive:!1})}Ga(){void 0===this.ba.Ja&&void 0===this.ba.Qa&&void 0===this.ba.io||(this.ka.addEventListener("touchstart",(t=>this.so(t.touches)),{passive:!0}),this.ka.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.sa&&void 0!==this.ba.Qa){const i=Ds(t.touches[0],t.touches[1])/this.ea;this.ba.Qa(this.sa,i),Ls(t)}}),{passive:!1}),this.ka.addEventListener("touchend",(t=>{this.so(t.touches)})))}so(t){1===t.length&&(this.na=!1),2!==t.length||this.na||this.$l?this.eo():this.no(t)}no(t){const i=this.ka.getBoundingClientRect()||{left:0,top:0};this.sa={G:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,J:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.ea=Ds(t[0],t[1]),void 0!==this.ba.Ja&&this.ba.Ja(),this.xa()}eo(){null!==this.sa&&(this.sa=null,void 0!==this.ba.io&&this.ba.io())}Ka(t){if(this.Ql&&this.Ql(),this.da(t))return;if(!this.oa)return;const i=this.fa(t);this.Ma(i,this.ba.ho),this.oa=!ms()}Ua(t){const i=As(t.touches,r(this.aa));if(null===i)return;const s=this.fa(t,i);this.ma(s,this.ba.ro),this.Zl=!0,this.$l=!0}da(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Es(t)<this.la+500}ma(t,i){i&&i.call(this.ba,t)}Ma(t,i){i&&i.call(this.ba,t)}fa(t,i){const s=i||t,e=this.ka.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-e.left,localY:s.clientY-e.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,lo:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,ao:t.type,oo:s.target,uo:t.view,co:()=>{"touchstart"!==t.type&&Ls(t)}}}}function Ds(t,i){const s=t.clientX-i.clientX,e=t.clientY-i.clientY;return Math.sqrt(s*s+e*e)}function Ls(t){t.cancelable&&t.preventDefault()}function Rs(t){return{G:t.pageX,J:t.pageY}}function Es(t){return t.timeStamp||performance.now()}function As(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Os{constructor(t,i,s,e){this.Ot=null,this._o=null,this.do=!1,this.fo=null,this.po="",this.vo=new Wt(200),this.ue=null,this.mo=0,this.bo=!1,this.wo=()=>{this.bo||this.zt.So().Mo().lightUpdate()},this.yo=()=>{this.bo||this.zt.So().Mo().lightUpdate()},this.zt=t,this.Gt=i,this.Qn=i.layout,this.al=s,this.ko="left"===e,this.Co=document.createElement("div"),this.Co.style.height="100%",this.Co.style.overflow="hidden",this.Co.style.width="25px",this.Co.style.left="0",this.Co.style.position="relative",this.xo=ys(this.Co,new ws(16,16)),this.xo.subscribeCanvasConfigured(this.wo);const n=this.xo.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.To=ys(this.Co,new ws(16,16)),this.To.subscribeCanvasConfigured(this.yo);const h=this.To.canvas;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0";const r={La:this.Po.bind(this),Xa:this.Do.bind(this),qa:this.Do.bind(this),Va:this.Lo.bind(this),Ia:this.Lo.bind(this),Za:this.Ro.bind(this),ja:this.Eo.bind(this),Wa:this.Eo.bind(this),Sa:this.Ao.bind(this),ga:this.Ao.bind(this),Da:this.Oo.bind(this),ho:this.Bo.bind(this)};this.Io=new Ps(this.To.canvas,r,{Oa:()=>!1,Ba:()=>!0})}destroy(){this.Io.destroy(),this.To.unsubscribeCanvasConfigured(this.yo),this.To.destroy(),this.xo.unsubscribeCanvasConfigured(this.wo),this.xo.destroy(),null!==this.Ot&&this.Ot.onMarksChanged().unsubscribeAll(this),this.Ot=null}No(){return this.Co}Vo(){return this.Qn.fontSize}Fo(){const t=this.al.options();return this.ue!==t.font&&(this.vo.reset(),this.ue=t.font),t}Wo(){if(null===this.Ot)return 0;let t=0;const i=this.Fo(),s=Ss(this.xo.canvas),e=this.Ot.marks();s.font=this.zo(),e.length>0&&(t=Math.max(this.vo.measureText(s,e[0].label),this.vo.measureText(s,e[e.length-1].label)));const n=this.jo();for(let i=n.length;i--;){const e=this.vo.measureText(s,n[i].text());e>t&&(t=e)}const h=this.Ot.firstValue();if(null!==h&&null!==this._o){const i=this.Ot.coordinateToPrice(1,h),e=this.Ot.coordinateToPrice(this._o.it-2,h);t=Math.max(t,this.vo.measureText(s,this.Ot.formatPrice(Math.floor(Math.min(i,e))+.11111111111111,h)),this.vo.measureText(s,this.Ot.formatPrice(Math.ceil(Math.max(i,e))-.11111111111111,h)))}const r=t||34;let l=Math.ceil(i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+5+r);return l+=l%2,l}Ho(t){if(t.tt<0||t.it<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this._o&&this._o.Ml(t)||(this._o=t,this.bo=!0,this.xo.resizeCanvas({width:t.tt,height:t.it}),this.To.resizeCanvas({width:t.tt,height:t.it}),this.bo=!1,this.Co.style.width=t.tt+"px",this.Co.style.height=t.it+"px",this.Co.style.minWidth=t.tt+"px")}$o(){return r(this._o).tt}Uo(t){this.Ot!==t&&(null!==this.Ot&&this.Ot.onMarksChanged().unsubscribeAll(this),this.Ot=t,t.onMarksChanged().subscribe(this.$n.bind(this),this))}qo(){return this.Ot}Yo(){const t=this.zt.Xo();this.zt.So().Mo().resetPriceScale(t,r(this.qo()))}Zo(t){if(null===this._o)return;if(1!==t){const t=Ss(this.xo.canvas);this.Ko(),this.Go(t,this.xo.pixelRatio),this.rs(t,this.xo.pixelRatio),this.Jo(t,this.xo.pixelRatio),this.Qo(t,this.xo.pixelRatio)}const i=Ss(this.To.canvas),s=this._o.tt,e=this._o.it;V(i,this.To.pixelRatio,(()=>{i.clearRect(0,0,s,e)})),this.tu(i,this.To.pixelRatio)}iu(){return this.xo.canvas}lt(){var t;null===(t=this.Ot)||void 0===t||t.marks()}su(){const t=[];for(const i of this.zt.Xo().orderedSources())i instanceof yi&&t.push(...i.customPriceLines().filter((t=>t.options().draggable&&t.priceAxisView().isAxisLabelVisible())));return t}eu(t){const i=this.Fo();for(const s of this.su()){const e=s.priceAxisView(),n=e.height(i,!1),h=e.getFixedCoordinate();if(h-n/2<=t&&t<=h+n/2)return s}return null}Po(t){null!==this.eu(t.localY)?this.nu(2):this.nu(1)}Do(t){if(null===this.Ot||this.Ot.isEmpty())return;this.do=!0;const i=this.eu(t.localY);if(i){this.fo=i;const t=i.options().price,s=r(this.Ot.firstValue());return this.po=this.Ot.formatPrice(t,s),void this.nu(3)}if(!this.zt.So().hu().handleScale.axisPressedMouseMove.price)return;const s=this.zt.So().Mo(),e=this.zt.Xo();s.startScalePrice(e,this.Ot,t.localY)}Lo(t){if(null===this.Ot)return;const i=this.Ot;if(this.fo){const s=r(i.firstValue()),e=i.coordinateToPrice(t.localY,s);return void this.fo.applyOptions({price:e})}if(!this.zt.So().hu().handleScale.axisPressedMouseMove.price)return;const s=this.zt.So().Mo(),e=this.zt.Xo();s.scalePriceTo(e,i,t.localY)}Ro(){if(null!==this.Ot&&this.do){if(this.do=!1,this.fo=null,this.po="",!this.zt.So().hu().handleScale.axisPressedMouseMove.price)return;const t=this.zt.So().Mo(),i=this.zt.Xo(),s=this.Ot;t.endScalePrice(i,s)}}Eo(t){if(null===this.Ot)return;const i=this.zt.So().Mo();if(this.do=!1,this.fo)return i.fireCustomPriceLineDragged(this.fo,this.po),this.fo=null,this.po="",void this.nu(2);if(!this.zt.So().hu().handleScale.axisPressedMouseMove.price)return;const s=this.zt.Xo();i.endScalePrice(s,this.Ot)}Ao(t){null===this.eu(t.localY)&&this.Gt.handleScale.axisDoubleClickReset.price&&this.Yo()}Oo(t){if(null===this.Ot)return;if(null!==this.fo)return void this.nu(3);if(null!==this.eu(t.localY))return void this.nu(2);!this.zt.So().Mo().options().handleScale.axisPressedMouseMove.price||this.Ot.isPercentage()||this.Ot.isIndexedTo100()||this.nu(1)}Bo(t){this.nu(0)}jo(){const t=[],i=null===this.Ot?void 0:this.Ot;return(s=>{for(let e=0;e<s.length;++e){const n=s[e].priceAxisViews(this.zt.Xo(),i);for(let i=0;i<n.length;i++)t.push(n[i])}})(this.zt.Xo().orderedSources()),t}Go(t,i){if(null===this._o)return;const s=this._o.tt,e=this._o.it;V(t,i,(()=>{const i=this.zt.Xo().model(),n=i.backgroundTopColor(),h=i.backgroundBottomColor();n===h?F(t,0,0,s,e,n):H(t,0,0,s,e,n,h)}))}rs(t,i){if(null===this._o||null===this.Ot||!this.Ot.options().borderVisible)return;t.save(),t.fillStyle=this.Ot.options().borderColor;const s=Math.max(1,Math.floor(this.Fo().borderSize*i));let e;e=this.ko?Math.floor(this._o.tt*i)-s:0,t.fillRect(e,0,s,Math.ceil(this._o.it*i)),t.restore()}Jo(t,i){var s;if(null===this._o||null===this.Ot)return;const e=this.Ot.marks();t.save();const n=this.Ot.options();t.strokeStyle=n.borderColor,t.font=this.zo(),t.fillStyle=n.borderColor;const h=this.Fo(),r=this.ko?Math.floor((this._o.tt-h.tickLength)*i):0,l=this.ko?Math.round(r-h.paddingInner*i):Math.round(r+h.tickLength*i+h.paddingInner*i),a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(n.borderVisible&&n.ticksVisible){const s=Math.round(h.tickLength*i);t.beginPath();for(const n of e)t.rect(r,Math.round(n.coord*i)-o,s,a);t.fill()}t.fillStyle=null!==(s=n.textColor)&&void 0!==s?s:this.Qn.textColor,t.textAlign=this.ko?"right":"left",t.textBaseline="middle";const u=e.map((i=>this.vo.yMidCorrection(t,i.label)));V(t,i,(()=>{for(let s=e.length;s--;){const n=e[s];t.fillText(n.label,l/i,n.coord+u[s])}})),t.restore()}Ko(){if(null===this._o||null===this.Ot)return;let t=this._o.it/2;const i=[],s=this.Ot.orderedSources().slice(),e=this.zt.Xo(),n=this.Fo();this.Ot===e.defaultVisiblePriceScale()&&this.zt.Xo().orderedSources().forEach((t=>{e.isOverlay(t)&&s.push(t)}));const h=this.Ot.dataSources()[0],r=this.Ot;s.forEach((s=>{const n=s.priceAxisViews(e,r);n.forEach((t=>{t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),h===s&&n.length>0&&(t=n[0].coordinate())})),i.forEach((t=>t.setFixedCoordinate(t.coordinate())));this.Ot.options().alignLabels&&this.ru(i,n,t)}ru(t,i,s){if(null===this._o)return;const e=t.filter((t=>t.coordinate()<=s)),n=t.filter((t=>t.coordinate()>s));e.sort(((t,i)=>i.coordinate()-t.coordinate())),e.length&&n.length&&n.push(e[0]),n.sort(((t,i)=>t.coordinate()-i.coordinate()));for(const s of t){const t=Math.floor(s.height(i)/2),e=s.coordinate();e>-t&&e<t&&s.setFixedCoordinate(t),e>this._o.it-t&&e<this._o.it+t&&s.setFixedCoordinate(this._o.it-t)}for(let t=1;t<e.length;t++){const s=e[t],n=e[t-1],h=n.height(i,!1),r=s.coordinate(),l=n.getFixedCoordinate();r>l-h&&s.setFixedCoordinate(l-h)}for(let t=1;t<n.length;t++){const s=n[t],e=n[t-1],h=e.height(i,!0),r=s.coordinate(),l=e.getFixedCoordinate();r<l+h&&s.setFixedCoordinate(l+h)}}Qo(t,i){if(null===this._o)return;t.save();const s=this._o,e=this.jo(),n=this.Fo(),h=this.ko?"right":"left";e.forEach((e=>{if(e.isAxisLabelVisible()){const l=e.renderer(r(this.Ot));t.save(),l.draw(t,n,this.vo,s.tt,h,i),t.restore()}})),t.restore()}tu(t,i){if(null===this._o||null===this.Ot)return;t.save();const s=this._o,e=this.zt.So().Mo(),n=[],h=this.zt.Xo(),l=e.crosshairSource().priceAxisViews(h,this.Ot);l.length&&n.push(l);const a=this.Fo(),o=this.ko?"right":"left";n.forEach((e=>{e.forEach((e=>{t.save(),e.renderer(r(this.Ot)).draw(t,a,this.vo,s.tt,o,i),t.restore()}))})),t.restore()}nu(t){let i="default";1===t?i="ns-resize":2===t?i="grab":3===t&&(i="grabbing"),this.Co.style.cursor=i}$n(){const t=this.Wo();this.mo<t&&this.zt.So().Mo().fullUpdate(),this.mo=t}zo(){return T(this.Qn.fontSize,this.Qn.fontFamily)}}function Bs(t,i,s,e,n){t.drawBackground&&t.drawBackground(i,s,e,n)}function Is(t,i,s,e,n){t.draw(i,s,e,n)}function Ns(t,i){return t.paneViews(i)}function Vs(t,i){return t.labelPaneViews(i)}function Fs(t,i){return void 0!==t.topPaneViews?t.topPaneViews(i):[]}class Ws{constructor(t,i){this._o=new ws(0,0),this.lu=null,this.au=null,this.ou=null,this.uu=!1,this.cu=new m,this._u=0,this.du=!1,this.fu=null,this.pu=!1,this.vu=null,this.mu=null,this.bo=!1,this.wo=()=>{this.bo||null===this.gu||this.Vt().lightUpdate()},this.yo=()=>{this.bo||null===this.gu||this.Vt().lightUpdate()},this.bu=t,this.gu=i,this.gu.onDestroyed().subscribe(this.wu.bind(this),this,!0),this.Mu=document.createElement("td"),this.Mu.style.padding="0",this.Mu.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Su=document.createElement("td"),this.Su.style.padding="0",this.yu=document.createElement("td"),this.yu.style.padding="0",this.Mu.appendChild(s),this.xo=ys(s,new ws(16,16)),this.xo.subscribeCanvasConfigured(this.wo);const e=this.xo.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.To=ys(s,new ws(16,16)),this.To.subscribeCanvasConfigured(this.yo);const n=this.To.canvas;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this.ku=document.createElement("tr"),this.ku.appendChild(this.Su),this.ku.appendChild(this.Mu),this.ku.appendChild(this.yu),this.Cu(),this.Io=new Ps(this.To.canvas,this,{Oa:()=>null===this.fu&&!this.bu.hu().handleScroll.vertTouchDrag,Ba:()=>null===this.fu&&!this.bu.hu().handleScroll.horzTouchDrag})}destroy(){null!==this.lu&&this.lu.destroy(),null!==this.au&&this.au.destroy(),this.To.unsubscribeCanvasConfigured(this.yo),this.To.destroy(),this.xo.unsubscribeCanvasConfigured(this.wo),this.xo.destroy(),null!==this.gu&&this.gu.onDestroyed().unsubscribeAll(this),this.Io.destroy()}Xo(){return r(this.gu)}xu(t){null!==this.gu&&this.gu.onDestroyed().unsubscribeAll(this),this.gu=t,null!==this.gu&&this.gu.onDestroyed().subscribe(Ws.prototype.wu.bind(this),this,!0),this.Cu()}So(){return this.bu}No(){return this.ku}Cu(){if(null!==this.gu&&(this.Tu(),0!==this.Vt().serieses().length)){if(null!==this.lu){const t=this.gu.leftPriceScale();this.lu.Uo(r(t))}if(null!==this.au){const t=this.gu.rightPriceScale();this.au.Uo(r(t))}}}Pu(){null!==this.lu&&this.lu.lt(),null!==this.au&&this.au.lt()}Du(){return null!==this.gu?this.gu.stretchFactor():0}Lu(t){this.gu&&this.gu.setStretchFactor(t)}Da(t){if(!this.gu)return;this.Ru();const i=t.localX,s=t.localY;this.Eu(i,s,t)}Xa(t){this.Ru(),this.Au(),this.Eu(t.localX,t.localY,t)}La(t){if(!this.gu)return;this.Ru();const i=t.localX,s=t.localY;this.Eu(i,s,t);const e=this.Ou(i,s);this.Vt().setHoveredSource(e&&{source:e.Bu,object:e.Iu})}Ha(t){null!==this.gu&&(this.Ru(),this.Nu(t))}Va(t){this.Ru(),this.Vu(t),this.Eu(t.localX,t.localY,t)}ja(t){null!==this.gu&&(this.Ru(),this.du=!1,this.Fu(t))}za(t){null!==this.gu&&this.Nu(t)}ro(t){if(this.du=!0,null===this.fu){const i={x:t.localX,y:t.localY};this.Wu(i,i,t)}}ho(t){null!==this.gu&&(this.Ru(),this.gu.model().setHoveredSource(null),this.zu())}ju(){return this.cu}Ja(){this._u=1,this.Vt().stopTimeScaleAnimation()}Qa(t,i){if(!this.bu.hu().handleScale.pinch)return;const s=5*(i-this._u);this._u=i,this.Vt().zoomTime(t.G,s)}qa(t){if(this.du=!1,this.pu=null!==this.fu,this.Au(),null!==this.fu){const i=this.Vt().crosshairSource();this.vu={x:i.appliedX(),y:i.appliedY()},this.fu={x:t.localX,y:t.localY}}}Ia(t){if(null===this.gu)return;const i=t.localX,s=t.localY;if(null===this.fu)this.Vu(t);else{this.pu=!1;const e=r(this.vu),n=e.x+(i-this.fu.x),h=e.y+(s-this.fu.y);this.Eu(n,h,t)}}Wa(t){0===this.So().hu().trackingMode.exitMode&&(this.pu=!0),this.Hu(),this.Fu(t)}Ou(t,i){const s=this.gu;if(null===s)return null;const e=s.orderedSources();for(const n of e){const e=this.$u(n.paneViews(s),t,i);if(null!==e)return{Bu:n,uo:e.uo,Iu:e.Iu}}return null}Uu(t,i){r("left"===i?this.lu:this.au).Ho(new ws(t,this._o.it))}qu(){return this._o}Ho(t){if(t.tt<0||t.it<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this._o.Ml(t)||(this._o=t,this.bo=!0,this.xo.resizeCanvas({width:t.tt,height:t.it}),this.To.resizeCanvas({width:t.tt,height:t.it}),this.bo=!1,this.Mu.style.width=t.tt+"px",this.Mu.style.height=t.it+"px")}Yu(){const t=r(this.gu);t.recalculatePriceScale(t.leftPriceScale()),t.recalculatePriceScale(t.rightPriceScale());for(const i of t.dataSources())if(t.isOverlay(i)){const s=i.priceScale();null!==s&&t.recalculatePriceScale(s),i.updateAllViews()}}iu(){return this.xo.canvas}Zo(t){if(0===t)return;if(null===this.gu)return;if(t>1&&this.Yu(),null!==this.lu&&this.lu.Zo(t),null!==this.au&&this.au.Zo(t),1!==t){const t=Ss(this.xo.canvas);t.save(),this.Go(t,this.xo.pixelRatio),this.gu&&(this.Xu(t,this.xo.pixelRatio),this.Zu(t,this.xo.pixelRatio),this.Ku(t,this.xo.pixelRatio,Ns),this.Ku(t,this.xo.pixelRatio,Vs)),t.restore()}const i=Ss(this.To.canvas);i.clearRect(0,0,Math.ceil(this._o.tt*this.To.pixelRatio),Math.ceil(this._o.it*this.To.pixelRatio)),this.Ku(i,this.xo.pixelRatio,Fs),this.Gu(i,this.To.pixelRatio)}Ju(){return this.lu}Qu(){return this.au}wu(){null!==this.gu&&this.gu.onDestroyed().unsubscribeAll(this),this.gu=null}Nu(t){const i=t.localX;this.cu.p()&&this.cu._(this.Vt().timeScale().coordinateToIndex(i),t)}Go(t,i){V(t,i,(()=>{const i=this.Vt(),s=i.backgroundTopColor(),e=i.backgroundBottomColor();s===e?F(t,0,0,this._o.tt,this._o.it,e):H(t,0,0,this._o.tt,this._o.it,s,e)}))}Xu(t,i){const s=r(this.gu),e=s.grid().paneView().renderer(s.height(),s.width());null!==e&&(t.save(),e.draw(t,i,!1),t.restore())}Zu(t,i){const s=this.Vt().watermarkSource();this.tc(t,i,Ns,Bs,s),this.tc(t,i,Ns,Is,s)}Gu(t,i){this.tc(t,i,Ns,Is,this.Vt().crosshairSource())}Ku(t,i,s){const e=r(this.gu).orderedSources();for(const n of e)this.tc(t,i,s,Bs,n);for(const n of e)this.tc(t,i,s,Is,n)}tc(t,i,s,e,n){const h=r(this.gu),l=s(n,h),a=h.height(),o=h.width(),u=h.model().hoveredSource(),c=null!==u&&u.source===n,_=null!==u&&c&&void 0!==u.object?u.object.hitTestData:void 0;for(const s of l){const n=s.renderer(a,o);null!==n&&(t.save(),e(n,t,i,c,_),t.restore())}}$u(t,i,s){for(const e of t){const t=e.renderer(this._o.it,this._o.tt);if(null!==t&&t.hitTest){const n=t.hitTest(i,s);if(null!==n)return{uo:e,Iu:n}}}return null}Tu(){if(null===this.gu)return;const t=this.bu,i=this.gu.leftPriceScale().options().visible,s=this.gu.rightPriceScale().options().visible;i||null===this.lu||(this.Su.removeChild(this.lu.No()),this.lu.destroy(),this.lu=null),s||null===this.au||(this.yu.removeChild(this.au.No()),this.au.destroy(),this.au=null);const e=t.Mo().rendererOptionsProvider();i&&null===this.lu&&(this.lu=new Os(this,t.hu(),e,"left"),this.Su.appendChild(this.lu.No())),s&&null===this.au&&(this.au=new Os(this,t.hu(),e,"right"),this.yu.appendChild(this.au.No()))}ic(t){return t.lo&&this.du||null!==this.fu}sc(t){return Math.max(0,Math.min(t,this._o.tt-1))}ec(t){return Math.max(0,Math.min(t,this._o.it-1))}Eu(t,i,s){this.Vt().setAndSaveCurrentPosition(this.sc(t),this.ec(i),s,r(this.gu))}zu(){this.Vt().clearCurrentPosition()}Hu(){this.pu&&(this.fu=null,this.zu())}Wu(t,i,s){this.fu=t,this.pu=!1,this.Eu(i.x,i.y,s);const e=this.Vt().crosshairSource();this.vu={x:e.appliedX(),y:e.appliedY()}}Vt(){return this.bu.Mo()}Fu(t){if(!this.uu)return;const i=this.Vt(),s=this.Xo();if(i.endScrollPrice(s,s.defaultPriceScale()),this.ou=null,this.uu=!1,i.endScrollTime(),null!==this.mu){const t=performance.now(),s=i.timeScale();this.mu.qs(s.rightOffset(),t),this.mu.Bl(t)||i.setTimeScaleAnimation(this.mu)}}nc(t,i,s){if(this.gu)if(s){const s=t,e=i;this.hc(s,e)}else this.gu.model().setHoveredSource(null),this.zu()}rc(){this.zu()}hc(t,i){this.Vt().setAndSaveCurrentPositionFire(this.sc(t),this.ec(i),!1,r(this.gu))}Ru(){this.fu=null}Au(){if(!this.gu)return;if(this.Vt().stopTimeScaleAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)r(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.gu.defaultPriceScale().isEmpty()&&this.Vt().timeScale().isEmpty()}Vu(t){if(null===this.gu)return;const i=this.Vt(),s=i.timeScale();if(s.isEmpty())return;const e=this.bu.hu(),n=e.handleScroll,h=e.kineticScroll;if((!n.pressedMouseMove||t.lo)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t.lo))return;const r=this.gu.defaultPriceScale(),l=performance.now();if(null!==this.ou||this.ic(t)||(this.ou={x:t.clientX,y:t.clientY,lc:l,ac:t.localX,oc:t.localY}),null!==this.ou&&!this.uu&&(this.ou.x!==t.clientX||this.ou.y!==t.clientY)){if(t.lo&&h.touch||!t.lo&&h.mouse){const t=s.barSpacing();this.mu=new xs(.2/t,7/t,.997,15/t),this.mu.Al(s.rightOffset(),this.ou.lc)}else this.mu=null;r.isEmpty()||i.startScrollPrice(this.gu,r,t.localY),i.startScrollTime(t.localX),this.uu=!0}this.uu&&(r.isEmpty()||i.scrollPriceTo(this.gu,r,t.localY),i.scrollTimeTo(t.localX),null!==this.mu&&this.mu.Al(s.rightOffset(),l))}}class zs{constructor(t,i,s,e,n){this.$=!0,this._o=new ws(0,0),this.wo=()=>this.Zo(3),this.ko="left"===t,this.al=s.uc,this.Gt=i,this.cc=e,this._c=n,this.Co=document.createElement("div"),this.Co.style.width="25px",this.Co.style.height="100%",this.Co.style.overflow="hidden",this.xo=ys(this.Co,new ws(16,16)),this.xo.subscribeCanvasConfigured(this.wo)}destroy(){this.xo.unsubscribeCanvasConfigured(this.wo),this.xo.destroy()}No(){return this.Co}qu(){return this._o}Ho(t){if(t.tt<0||t.it<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this._o.Ml(t)||(this._o=t,this.xo.resizeCanvas({width:t.tt,height:t.it}),this.Co.style.width=`${t.tt}px`,this.Co.style.minWidth=`${t.tt}px`,this.Co.style.height=`${t.it}px`,this.$=!0)}Zo(t){if(t<3&&!this.$)return;if(0===this._o.tt||0===this._o.it)return;this.$=!1;const i=Ss(this.xo.canvas);this.Go(i,this.xo.pixelRatio),this.rs(i,this.xo.pixelRatio)}iu(){return this.xo.canvas}rs(t,i){if(!this.cc())return;const s=this._o.tt;t.save(),t.fillStyle=this.Gt.timeScale.borderColor;const e=Math.floor(this.al.options().borderSize*i),n=this.ko?Math.round(s*i)-e:0;t.fillRect(n,0,e,e),t.restore()}Go(t,i){V(t,i,(()=>{F(t,0,0,this._o.tt,this._o.it,this._c())}))}}function js(t,i){return t.weight>i.weight?t:i}class Hs{constructor(t){this.dc=null,this.fc=null,this.m=null,this.vc=!1,this._o=new ws(0,0),this.mc=new m,this.vo=new Wt(5),this.bo=!1,this.wo=()=>{this.bo||this.bu.Mo().lightUpdate()},this.yo=()=>{this.bo||this.bu.Mo().lightUpdate()},this.bu=t,this.Gt=t.hu().layout,this.gc=document.createElement("tr"),this.bc=document.createElement("td"),this.bc.style.padding="0",this.wc=document.createElement("td"),this.wc.style.padding="0",this.Co=document.createElement("td"),this.Co.style.height="25px",this.Co.style.padding="0",this.Mc=document.createElement("div"),this.Mc.style.width="100%",this.Mc.style.height="100%",this.Mc.style.position="relative",this.Mc.style.overflow="hidden",this.Co.appendChild(this.Mc),this.xo=ys(this.Mc,new ws(16,16)),this.xo.subscribeCanvasConfigured(this.wo);const i=this.xo.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.To=ys(this.Mc,new ws(16,16)),this.To.subscribeCanvasConfigured(this.yo);const s=this.To.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.gc.appendChild(this.bc),this.gc.appendChild(this.Co),this.gc.appendChild(this.wc),this.Sc(),this.bu.Mo().priceScalesOptionsChanged().subscribe(this.Sc.bind(this),this),this.Io=new Ps(this.To.canvas,this,{Oa:()=>!0,Ba:()=>!1})}destroy(){this.Io.destroy(),null!==this.dc&&this.dc.destroy(),null!==this.fc&&this.fc.destroy(),this.To.unsubscribeCanvasConfigured(this.yo),this.To.destroy(),this.xo.unsubscribeCanvasConfigured(this.wo),this.xo.destroy()}No(){return this.gc}yc(){return this.dc}kc(){return this.fc}Xa(t){if(this.vc)return;this.vc=!0;const i=this.bu.Mo();!i.timeScale().isEmpty()&&this.bu.hu().handleScale.axisPressedMouseMove.time&&i.startScaleTime(t.localX)}qa(t){this.Xa(t)}Za(){const t=this.bu.Mo();!t.timeScale().isEmpty()&&this.vc&&(this.vc=!1,this.bu.hu().handleScale.axisPressedMouseMove.time&&t.endScaleTime())}Va(t){const i=this.bu.Mo();!i.timeScale().isEmpty()&&this.bu.hu().handleScale.axisPressedMouseMove.time&&i.scaleTimeTo(t.localX)}Ia(t){this.Va(t)}ja(){this.vc=!1;const t=this.bu.Mo();t.timeScale().isEmpty()&&!this.bu.hu().handleScale.axisPressedMouseMove.time||t.endScaleTime()}Wa(){this.ja()}Sa(){this.bu.hu().handleScale.axisDoubleClickReset.time&&this.bu.Mo().resetTimeScale()}ga(){this.Sa()}Da(){this.bu.Mo().options().handleScale.axisPressedMouseMove.time&&this.nu(1)}ho(){this.nu(0)}qu(){return this._o}Cc(){return this.mc}xc(t,i,s){this._o&&this._o.Ml(t)||(this._o=t,this.bo=!0,this.xo.resizeCanvas({width:t.tt,height:t.it}),this.To.resizeCanvas({width:t.tt,height:t.it}),this.bo=!1,this.Co.style.width=t.tt+"px",this.Co.style.height=t.it+"px",this.mc._(t)),null!==this.dc&&this.dc.Ho(new ws(i,t.it)),null!==this.fc&&this.fc.Ho(new ws(s,t.it))}Tc(){const t=this.Pc();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom+t.labelBottomOffset)}lt(){this.bu.Mo().timeScale().marks()}iu(){return this.xo.canvas}Zo(t){if(0===t)return;if(1!==t){const i=Ss(this.xo.canvas);this.Go(i,this.xo.pixelRatio),this.rs(i,this.xo.pixelRatio),this.Jo(i,this.xo.pixelRatio),null!==this.dc&&this.dc.Zo(t),null!==this.fc&&this.fc.Zo(t)}const i=Ss(this.To.canvas),s=this.To.pixelRatio;i.clearRect(0,0,Math.ceil(this._o.tt*s),Math.ceil(this._o.it*s)),this.Dc([this.bu.Mo().crosshairSource()],i,s)}Go(t,i){V(t,i,(()=>{F(t,0,0,this._o.tt,this._o.it,this.bu.Mo().backgroundBottomColor())}))}rs(t,i){if(this.bu.hu().timeScale.borderVisible){t.save(),t.fillStyle=this.Lc();const s=Math.max(1,Math.floor(this.Pc().borderSize*i));t.fillRect(0,0,Math.ceil(this._o.tt*i),s),t.restore()}}Jo(t,i){const s=this.bu.Mo().timeScale(),e=s.marks();if(!e||0===e.length)return;let n=e.reduce(js,e[0]).weight;n>30&&n<50&&(n=30),t.save(),t.strokeStyle=this.Lc();const h=this.Pc(),r=h.borderSize+h.tickLength+h.paddingTop+h.fontSize/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.Lc();const l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i),o=s.options();if(o.borderVisible&&o.ticksVisible){t.beginPath();const s=Math.round(h.tickLength*i);for(let n=e.length;n--;){const h=Math.round(e[n].coord*i);t.rect(h-a,0,l,s)}t.fill()}t.fillStyle=this.k(),V(t,i,(()=>{t.font=this.zo();for(const i of e)if(i.weight<n){const s=i.needAlignCoordinate?this.Rc(t,i.coord,i.label):i.coord;t.fillText(i.label,s,r)}t.font=this.Ec();for(const i of e)if(i.weight>=n){const s=i.needAlignCoordinate?this.Rc(t,i.coord,i.label):i.coord;t.fillText(i.label,s,r)}})),t.restore()}Rc(t,i,s){const e=this.vo.measureText(t,s),n=e/2,h=Math.floor(i-n)+.5;return h<0?i+=Math.abs(0-h):h+e>this._o.tt&&(i-=Math.abs(this._o.tt-(h+e))),i}Dc(t,i,s){const e=this.Pc();for(const n of t)for(const t of n.timeAxisViews())i.save(),t.renderer().draw(i,e,s),i.restore()}Lc(){return this.bu.hu().timeScale.borderColor}k(){return this.Gt.textColor}M(){return this.Gt.fontSize}zo(){return T(this.M(),this.Gt.fontFamily)}Ec(){return T(this.M(),this.Gt.fontFamily,"bold")}Pc(){null===this.m&&(this.m={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:5,fontSize:NaN,font:"",widthCache:new Wt,labelBottomOffset:0});const t=this.m,i=this.zo();if(t.font!==i){const s=this.M();t.fontSize=s,t.font=i,t.paddingTop=3*s/12,t.paddingBottom=3*s/12,t.paddingHorizontal=9*s/12,t.baselineOffset=0,t.labelBottomOffset=4*s/12,t.widthCache.reset()}return this.m}nu(t){this.Co.style.cursor=1===t?"ew-resize":"default"}Sc(){const t=this.bu.Mo(),i=t.options();i.leftPriceScale.visible||null===this.dc||(this.bc.removeChild(this.dc.No()),this.dc.destroy(),this.dc=null),i.rightPriceScale.visible||null===this.fc||(this.wc.removeChild(this.fc.No()),this.fc.destroy(),this.fc=null);const s={uc:this.bu.Mo().rendererOptionsProvider()},e=()=>i.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible,n=()=>t.backgroundBottomColor();i.leftPriceScale.visible&&null===this.dc&&(this.dc=new zs("left",i,s,e,n),this.bc.appendChild(this.dc.No())),i.rightPriceScale.visible&&null===this.fc&&(this.fc=new zs("right",i,s,e,n),this.wc.appendChild(this.fc.No()))}}const $s=!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&((null===(Us=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===Us?void 0:Us.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var Us;class qs{constructor(t,i){var s;this.Ac=[],this.Oc=0,this.In=0,this.Ls=0,this.Bc=0,this.Ic=0,this.Nc=null,this.Vc=!1,this.cu=new m,this.nl=new m,this.hl=new m,this.Gt=i,this.gc=document.createElement("div"),this.gc.classList.add("tv-lightweight-charts"),this.gc.style.overflow="hidden",this.gc.style.width="100%",this.gc.style.height="100%",(s=this.gc).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.Fc=document.createElement("table"),this.Fc.setAttribute("cellspacing","0"),this.gc.appendChild(this.Fc),this.Wc=this.zc.bind(this),Ys(this.Gt)&&this.jc(!0),this.Vt=new _s(this.ll.bind(this),this.Gt),this.Mo().crosshairMoved().subscribe(this.Hc.bind(this),this),this.Mo().customPriceLineDragged().subscribe(this.$c.bind(this),this),this.Uc=new Hs(this),this.Fc.appendChild(this.Uc.No());let e=this.Gt.width,n=this.Gt.height;if(0===e||0===n){const i=t.getBoundingClientRect();0===e&&(e=Math.floor(i.width),e-=e%2),0===n&&(n=Math.floor(i.height),n-=n%2)}this.qc(e,n),this.Yc(),t.appendChild(this.gc),this.Xc(),this.Vt.timeScale().optionsApplied().subscribe(this.Vt.fullUpdate.bind(this.Vt),this),this.Vt.priceScalesOptionsChanged().subscribe(this.Vt.fullUpdate.bind(this.Vt),this)}Mo(){return this.Vt}hu(){return this.Gt}Zc(){return this.Ac}Kc(){return this.Uc}destroy(){this.jc(!1),0!==this.Oc&&window.cancelAnimationFrame(this.Oc),this.Vt.crosshairMoved().unsubscribeAll(this),this.Vt.customPriceLineDragged().unsubscribeAll(this),this.Vt.timeScale().optionsApplied().unsubscribeAll(this),this.Vt.priceScalesOptionsChanged().unsubscribeAll(this),this.Vt.destroy();for(const t of this.Ac)this.Fc.removeChild(t.No()),t.ju().unsubscribeAll(this),t.destroy();this.Ac=[],r(this.Uc).destroy(),null!==this.gc.parentElement&&this.gc.parentElement.removeChild(this.gc),this.nl.v(),this.cu.v()}Gc(){return this.hl}qc(t,i,s=!1){if(this.In===i&&this.Ls===t)return;this.In=i,this.Ls=t;const e=i+"px",n=t+"px";r(this.gc).style.height=e,r(this.gc).style.width=n,this.Fc.style.height=e,this.Fc.style.width=n,s?this.Jc(tt.full(),performance.now()):this.Vt.fullUpdate()}Zo(t){void 0===t&&(t=tt.full());for(let i=0;i<this.Ac.length;i++)this.Ac[i].Zo(t.invalidateForPane(i).level);this.Gt.timeScale.visible&&this.Uc.Zo(t.fullInvalidation())}Qc(t){const i=Ys(this.Gt);this.Vt.applyOptions(t);const s=Ys(this.Gt);s!==i&&this.jc(s),this.Xc();const e=t.width||this.Ls,n=t.height||this.In;this.qc(e,n)}ju(){return this.cu}t_(){return this.nl}i_(){null!==this.Nc&&(this.Jc(this.Nc,performance.now()),this.Nc=null);const t=this.Ac[0],i=function(t,i){const s=t.createElement("canvas"),e=Ms(s);return s.style.width=`${i.tt}px`,s.style.height=`${i.it}px`,s.width=i.tt*e,s.height=i.it*e,s}(document,new ws(this.Ls,this.In)),s=Ss(i),e=Ms(i);return V(s,e,(()=>{let i=0,e=0;const n=t=>{for(let n=0;n<this.Ac.length;n++){const h=this.Ac[n],l=h.qu().it,a=r("left"===t?h.Ju():h.Qu()),o=a.iu();s.drawImage(o,i,e,a.$o(),l),e+=l}};this.s_()&&(n("left"),i=r(t.Ju()).$o()),e=0;for(let t=0;t<this.Ac.length;t++){const n=this.Ac[t],h=n.qu(),r=n.iu();s.drawImage(r,i,e,h.tt,h.it),e+=h.it}i+=t.qu().tt,this.e_()&&(e=0,n("right"));const h=t=>{const n=r("left"===t?this.Uc.yc():this.Uc.kc()),h=n.qu(),l=n.iu();s.drawImage(l,i,e,h.tt,h.it)};if(this.Gt.timeScale.visible){i=0,this.s_()&&(h("left"),i=r(t.Ju()).$o());const n=this.Uc.qu(),l=this.Uc.iu();s.drawImage(l,i,e,n.tt,n.it),this.e_()&&(i+=t.qu().tt,h("right"),s.restore())}})),i}n_(t){if("left"===t&&!this.s_())return 0;if("right"===t&&!this.e_())return 0;if(0===this.Ac.length)return 0;return r("left"===t?this.Ac[0].Ju():this.Ac[0].Qu()).$o()}h_(){let t=0,i=0,s=0;for(const e of this.Ac)this.s_()&&(i=Math.max(i,r(e.Ju()).Wo())),this.e_()&&(s=Math.max(s,r(e.Qu()).Wo())),t+=e.Du();const e=this.Ls,n=this.In,h=Math.max(e-i-s,0),l=this.Gt.timeScale.visible;let a=l?this.Uc.Tc():0;a%2&&(a+=1);const o=0+a,u=n<o?0:n-o,c=u/t;let _=0;for(let t=0;t<this.Ac.length;++t){const e=this.Ac[t];e.xu(this.Vt.panes()[t]);let n=0,r=0;r=t===this.Ac.length-1?u-_:Math.round(e.Du()*c),n=Math.max(r,2),_+=n,e.Ho(new ws(h,n)),this.s_()&&e.Uu(i,"left"),this.e_()&&e.Uu(s,"right"),e.Xo()&&this.Vt.setPaneHeight(e.Xo(),n)}this.Uc.xc(new ws(l?h:0,a),l?i:0,l?s:0),this.Vt.setWidth(h),this.Bc!==i&&(this.Bc=i),this.Ic!==s&&(this.Ic=s)}jc(t){t?this.gc.addEventListener("wheel",this.Wc,{passive:!1}):this.gc.removeEventListener("wheel",this.Wc)}r_(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return $s?1/window.devicePixelRatio:1}zc(t){if(!(0!==t.deltaX&&this.Gt.handleScroll.mouseWheel||0!==t.deltaY&&this.Gt.handleScale.mouseWheel))return;const i=this.r_(t),s=i*t.deltaX/100,e=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==e&&this.Gt.handleScale.mouseWheel){const i=Math.sign(e)*Math.min(1,Math.abs(e)),s=t.clientX-this.gc.getBoundingClientRect().left;this.Mo().zoomTime(s,i)}0!==s&&this.Gt.handleScroll.mouseWheel&&this.Mo().scrollChart(-80*s)}Jc(t,i){var s;const e=t.fullInvalidation();3===e&&this.l_(),3!==e&&2!==e||(this.a_(t),this.o_(t,i),this.Uc.lt(),this.Ac.forEach((t=>{t.Pu()})),3===(null===(s=this.Nc)||void 0===s?void 0:s.fullInvalidation())&&(this.Nc.merge(t),this.l_(),this.a_(this.Nc),this.o_(this.Nc,i),t=this.Nc,this.Nc=null)),this.Zo(t)}o_(t,i){for(const s of t.timeScaleInvalidations())this.ci(s,i)}a_(t){const i=this.Vt.panes();for(let s=0;s<i.length;s++)t.invalidateForPane(s).autoScale&&i[s].momentaryAutoScale()}ci(t,i){const s=this.Vt.timeScale();switch(t.type){case 0:s.fitContent();break;case 1:s.setLogicalRange(t.value);break;case 2:s.setBarSpacing(t.value);break;case 3:s.setRightOffset(t.value);break;case 4:s.restoreDefault();break;case 5:t.value.finished(i)||s.setRightOffset(t.value.getPosition(i))}}ll(t){null!==this.Nc?this.Nc.merge(t):this.Nc=t,this.Vc||(this.Vc=!0,this.Oc=window.requestAnimationFrame((t=>{if(this.Vc=!1,this.Oc=0,null!==this.Nc){const i=this.Nc;this.Nc=null,this.Jc(i,t);for(const s of i.timeScaleInvalidations())if(5===s.type&&!s.value.finished(t)){this.Mo().setTimeScaleAnimation(s.value);break}}})))}l_(){this.Yc()}Yc(){const t=this.Vt.panes(),i=t.length,s=this.Ac.length;for(let t=i;t<s;t++){const t=h(this.Ac.pop());this.Fc.removeChild(t.No()),t.ju().unsubscribeAll(this),t.destroy()}for(let e=s;e<i;e++){const i=new Ws(this,t[e]);i.ju().subscribe(this.u_.bind(this),this),this.Ac.push(i),this.Fc.insertBefore(i.No(),this.Uc.No())}for(let s=0;s<i;s++){const i=t[s],e=this.Ac[s];e.Xo()!==i?e.xu(i):e.Cu()}this.Xc(),this.h_()}c_(t,i){var s;const e=new Map;if(null!==t){this.Vt.serieses().forEach((i=>{const s=i.bars().search(t);null!==s&&e.set(i,s)}))}let n;if(null!==t){const i=null===(s=this.Vt.timeScale().indexToTimeScalePoint(t))||void 0===s?void 0:s.originalTime;void 0!==i&&(n=i)}const h=this.Mo().hoveredSource(),r=null!==h&&h.source instanceof yi?h.source:void 0,l=null!==h&&void 0!==h.object?h.object.externalId:void 0;return{Ft:n,Yh:null!=t?t:void 0,__:i?{x:i.localX,y:i.localY}:void 0,d_:r,f_:e,p_:l,v_:null!=i?i:void 0}}u_(t,i){this.cu._((()=>this.c_(t,i)))}Hc(t,i){this.nl._((()=>this.c_(t,i)))}m_(t,i){return{g_:t,b_:i}}$c(t,i){this.hl._((()=>this.m_(t,i)))}Xc(){const t=this.Gt.timeScale.visible?"":"none";this.Uc.No().style.display=t}s_(){return this.Ac[0].Xo().leftPriceScale().options().visible}e_(){return this.Ac[0].Xo().rightPriceScale().options().visible}}function Ys(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function Xs(t,i,s,e){const n=s.value,h={index:i,time:t,value:[n,n,n,n],originalTime:e};return void 0!==s.color&&(h.color=s.color),h}function Zs(t){return void 0!==t.value}function Ks(t){return(i,s,e,n)=>{return void 0===(h=e).open&&void 0===h.value?{time:i,index:s,originalTime:n}:t(i,s,e,n);var h}}const Gs={Candlestick:Ks((function(t,i,s,e){const n={index:i,time:t,value:[s.open,s.high,s.low,s.close],originalTime:e};return void 0!==s.color&&(n.color=s.color),void 0!==s.borderColor&&(n.borderColor=s.borderColor),void 0!==s.wickColor&&(n.wickColor=s.wickColor),n})),Bar:Ks((function(t,i,s,e){const n={index:i,time:t,value:[s.open,s.high,s.low,s.close],originalTime:e};return void 0!==s.color&&(n.color=s.color),n})),Area:Ks((function(t,i,s,e){const n=s.value,h={index:i,time:t,value:[n,n,n,n],originalTime:e};return void 0!==s.lineColor&&(h.lineColor=s.lineColor),void 0!==s.topColor&&(h.topColor=s.topColor),void 0!==s.bottomColor&&(h.bottomColor=s.bottomColor),h})),Baseline:Ks((function(t,i,s,e){const n=s.value,h={index:i,time:t,value:[n,n,n,n],originalTime:e};return void 0!==s.topLineColor&&(h.topLineColor=s.topLineColor),void 0!==s.bottomLineColor&&(h.bottomLineColor=s.bottomLineColor),void 0!==s.topFillColor1&&(h.topFillColor1=s.topFillColor1),void 0!==s.topFillColor2&&(h.topFillColor2=s.topFillColor2),void 0!==s.bottomFillColor1&&(h.bottomFillColor1=s.bottomFillColor1),void 0!==s.bottomFillColor2&&(h.bottomFillColor2=s.bottomFillColor2),h})),Histogram:Ks(Xs),Line:Ks(Xs)};function Js(t){return Gs[t]}function Qs(t){return 60*t*60*1e3}function te(t){return 60*t*1e3}const ie=[{w_:(se=1,1e3*se),Xh:10},{w_:te(1),Xh:20},{w_:te(5),Xh:21},{w_:te(30),Xh:22},{w_:Qs(1),Xh:30},{w_:Qs(3),Xh:31},{w_:Qs(6),Xh:32},{w_:Qs(12),Xh:33}];var se;function ee(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=ie.length-1;s>=0;--s)if(Math.floor(i.getTime()/ie[s].w_)!==Math.floor(t.getTime()/ie[s].w_))return ie[s].Xh;return 0}function ne(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].time.timestamp,e=null!==s?new Date(1e3*s):null,n=0;for(let h=i;h<t.length;++h){const i=t[h],r=new Date(1e3*i.time.timestamp);null!==e&&(i.timeWeight=ee(r,e)),n+=i.time.timestamp-(s||i.time.timestamp),s=i.time.timestamp,e=r}if(0===i&&t.length>1){const i=Math.ceil(n/(t.length-1)),s=new Date(1e3*(t[0].time.timestamp-i));t[0].timeWeight=ee(new Date(1e3*t[0].time.timestamp),s)}}function he(t){if(!ds(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function re(t){if(!fs(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function le(t){return 0===t.length?null:ds(t[0].time)?he:re}function ae(t){return fs(t)?re(t):ds(t)?he(t):he(oe(t))}function oe(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ue(t){M(t.time)&&(t.time=oe(t.time))}function ce(t){return{Yh:0,M_:new Map,S_:t}}function _e(t){if(void 0!==t&&0!==t.length)return{y_:t[0].time.timestamp,k_:t[t.length-1].time.timestamp}}function de(t){let i;return t.forEach((t=>{void 0===i&&(i=t.originalTime)})),h(i)}function fe(t){void 0===t.Zh&&(t.Zh=t.time)}class pe{constructor(){this.C_=new Map,this.x_=new Map,this.T_=new Map,this.P_=[]}v(){this.C_.clear(),this.x_.clear(),this.T_.clear(),this.P_=[]}D_(t,i){let s=0!==this.C_.size,e=!1;const n=this.x_.get(t);if(void 0!==n)if(1===this.x_.size)s=!1,e=!0,this.C_.clear();else for(const i of this.P_)i.pointData.M_.delete(t)&&(e=!0);let h=[];if(0!==i.length){const s=i;s.forEach((t=>fe(t))),function(t){t.forEach(ue)}(i);const n=r(le(i)),l=Js(t.seriesType());h=s.map((i=>{const s=n(i.time);let h=this.C_.get(s.timestamp);void 0===h&&(h=ce(s),this.C_.set(s.timestamp,h),e=!0);const r=l(s,h.Yh,i,i.Zh);return h.M_.set(t,r),r}))}s&&this.L_(),this.R_(t,h);let l=-1;if(e){const t=[];this.C_.forEach((i=>{t.push({timeWeight:0,time:i.S_,pointData:i,originalTime:de(i.M_)})})),t.sort(((t,i)=>t.time.timestamp-i.time.timestamp)),l=this.E_(t)}return this.A_(t,l,function(t,i){const s=_e(t),e=_e(i);if(void 0!==s&&void 0!==e)return{lastBarUpdatedOrNewBarsAddedToTheRight:s.k_>=e.k_&&s.y_>=e.y_}}(this.x_.get(t),n))}O_(t){return this.D_(t,[])}B_(t,i){const s=i;fe(s),ue(i);const e=r(le([i]))(i.time),n=this.T_.get(t);if(void 0!==n&&e.timestamp<n.timestamp)throw new Error(`Cannot update oldest data, last time=${n.timestamp}, new time=${e.timestamp}`);let h=this.C_.get(e.timestamp);const l=void 0===h;void 0===h&&(h=ce(e),this.C_.set(e.timestamp,h));const a=Js(t.seriesType())(e,h.Yh,i,s.Zh);h.M_.set(t,a),this.I_(t,a);const o={lastBarUpdatedOrNewBarsAddedToTheRight:Zs(a)};if(!l)return this.A_(t,-1,o);const u={timeWeight:0,time:h.S_,pointData:h,originalTime:de(h.M_)},c=vt(this.P_,u.time.timestamp,((t,i)=>t.time.timestamp<i));this.P_.splice(c,0,u);for(let t=c;t<this.P_.length;++t)ve(this.P_[t].pointData,t);return ne(this.P_,c),this.A_(t,c,o)}I_(t,i){let s=this.x_.get(t);void 0===s&&(s=[],this.x_.set(t,s));const e=0!==s.length?s[s.length-1]:null;null===e||i.time.timestamp>e.time.timestamp?Zs(i)&&s.push(i):Zs(i)?s[s.length-1]=i:s.splice(-1,1),this.T_.set(t,i.time)}R_(t,i){0!==i.length?(this.x_.set(t,i.filter(Zs)),this.T_.set(t,i[i.length-1].time)):(this.x_.delete(t),this.T_.delete(t))}L_(){for(const t of this.P_)0===t.pointData.M_.size&&this.C_.delete(t.time.timestamp)}E_(t){let i=-1;for(let s=0;s<this.P_.length&&s<t.length;++s){const e=this.P_[s],n=t[s];if(e.time.timestamp!==n.time.timestamp){i=s;break}n.timeWeight=e.timeWeight,ve(n.pointData,s)}if(-1===i&&this.P_.length!==t.length&&(i=Math.min(this.P_.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)ve(t[s].pointData,s);return ne(t,i),this.P_=t,i}N_(){if(0===this.x_.size)return null;let t=0;return this.x_.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].index))})),t}A_(t,i,s){const e={V_:new Map,F_:{W_:this.N_()}};if(-1!==i)this.x_.forEach(((i,n)=>{e.V_.set(n,{zs:i,z_:n===t?s:void 0})})),this.x_.has(t)||e.V_.set(t,{zs:[],z_:s}),e.F_.j_=this.P_,e.F_.H_=i;else{const i=this.x_.get(t);e.V_.set(t,{zs:i||[],z_:s})}return e}}function ve(t,i){t.Yh=i,t.M_.forEach((t=>{t.index=i}))}function me(t){return{value:t.value[3],time:t.originalTime}}function ge(t){const i=me(t);return void 0!==t.color&&(i.color=t.color),i}function be(t){return{open:t.value[0],high:t.value[1],low:t.value[2],close:t.value[3],time:t.originalTime}}const we={Area:function(t){const i=me(t);return void 0!==t.lineColor&&(i.lineColor=t.lineColor),void 0!==t.topColor&&(i.topColor=t.topColor),void 0!==t.bottomColor&&(i.bottomColor=t.bottomColor),i},Line:ge,Baseline:function(t){const i=me(t);return void 0!==t.topLineColor&&(i.topLineColor=t.topLineColor),void 0!==t.bottomLineColor&&(i.bottomLineColor=t.bottomLineColor),void 0!==t.topFillColor1&&(i.topFillColor1=t.topFillColor1),void 0!==t.topFillColor2&&(i.topFillColor2=t.topFillColor2),void 0!==t.bottomFillColor1&&(i.bottomFillColor1=t.bottomFillColor1),void 0!==t.bottomFillColor2&&(i.bottomFillColor2=t.bottomFillColor2),i},Histogram:ge,Bar:function(t){const i=be(t);return void 0!==t.color&&(i.color=t.color),i},Candlestick:function(t){const i=be(t),{color:s,borderColor:e,wickColor:n}=t;return void 0!==s&&(i.color=s),void 0!==e&&(i.borderColor=e),void 0!==n&&(i.wickColor=n),i}};function Me(t){return we[t]}const Se={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},ye={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:x,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},ke={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:x},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Se),leftPriceScale:Object.assign(Object.assign({},Se),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Se),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:ye,localization:{locale:ps?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Ce={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},xe={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Te={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Pe={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},De={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Le={color:"#26a69a",base:0},Re={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Ee{constructor(t,i){this.U_=t,this.q_=i}applyOptions(t){this.U_.Mo().applyPriceScaleOptions(this.q_,t)}options(){return this.Ot().options()}formatPrice(t,i=0){return this.Ot().formatPrice(t,i)}width(){return Q(this.q_)?this.U_.n_(this.q_):0}Ot(){return r(this.U_.Mo().findPriceScale(this.q_)).priceScale}}const Ae={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",draggable:!1};class Oe{constructor(t){this.De=t}applyOptions(t){this.De.applyOptions(t)}options(){return this.De.options()}Y_(){return this.De}}class Be{constructor(t,i,s){this.Li=t,this.X_=i,this.Z_=s}priceFormatter(){return this.Li.formatter()}priceToCoordinate(t){const i=this.Li.firstValue();return null===i?null:this.Li.priceScale().priceToCoordinate(t,i.value)}coordinateToPrice(t){const i=this.Li.firstValue();return null===i?null:this.Li.priceScale().coordinateToPrice(t,i.value)}barsInLogicalRange(t){if(null===t)return null;const i=new ss(new Qi(t.from,t.to)).tr(),s=this.Li.bars();if(s.isEmpty())return null;const e=s.search(i.left(),1),n=s.search(i.right(),-1),h=r(s.firstIndex()),l=r(s.lastIndex());if(null!==e&&null!==n&&e.index>n.index)return{barsBefore:t.from-h,barsAfter:l-t.to};const a={barsBefore:null===e||e.index===h?t.from-h:e.index-h,barsAfter:null===n||n.index===l?l-t.to:l-n.index};return null!==e&&null!==n&&(a.from=e.time.businessDay||e.time.timestamp,a.to=n.time.businessDay||n.time.timestamp),a}setData(t){this.Li.seriesType(),this.X_.K_(this.Li,t)}update(t){this.Li.seriesType(),this.X_.G_(this.Li,t)}dataByIndex(t,i){const s=this.Li.bars().search(t,i);return null===s?null:Me(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:ae(t.time)})));this.Li.setMarkers(i)}markers(){return this.Li.markers().map((t=>{const{originalTime:i,time:s}=t,e=function(t,i){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.indexOf(e)<0&&(s[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(e=Object.getOwnPropertySymbols(t);n<e.length;n++)i.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},e)}))}applyOptions(t){this.Li.applyOptions(t)}options(){return y(this.Li.options())}priceScale(){return this.Z_.priceScale(this.Li.priceScale().id())}createPriceLine(t){const i=g(y(Ae),t),s=this.Li.createPriceLine(i);return new Oe(s)}removePriceLine(t){this.Li.removePriceLine(t.Y_())}seriesType(){return this.Li.seriesType()}}class Ie{constructor(t,i){this.J_=new m,this.cr=new m,this.mc=new m,this.Vt=t,this.gh=t.timeScale(),this.Uc=i,this.gh.visibleBarsChanged().subscribe(this.Q_.bind(this)),this.gh.logicalRangeChanged().subscribe(this.td.bind(this)),this.Uc.Cc().subscribe(this.sd.bind(this))}destroy(){this.gh.visibleBarsChanged().unsubscribeAll(this),this.gh.logicalRangeChanged().unsubscribeAll(this),this.Uc.Cc().unsubscribeAll(this),this.J_.v(),this.cr.v(),this.mc.v()}scrollPosition(){return this.gh.rightOffset()}scrollToPosition(t,i){i?this.gh.scrollToOffsetAnimated(t,1e3):this.Vt.setRightOffset(t)}scrollToRealTime(){this.gh.scrollToRealTime()}getVisibleRange(){var t,i;const s=this.gh.visibleTimeRange();return null===s?null:{from:null!==(t=s.from.businessDay)&&void 0!==t?t:s.from.timestamp,to:null!==(i=s.to.businessDay)&&void 0!==i?i:s.to.timestamp}}setVisibleRange(t){const i={from:ae(t.from),to:ae(t.to)},s=this.gh.logicalRangeForTimeRange(i);this.Vt.setTargetLogicalRange(s)}getVisibleLogicalRange(){const t=this.gh.visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}}setVisibleLogicalRange(t){n(t.from<=t.to,"The from index cannot be after the to index."),this.Vt.setTargetLogicalRange(t)}resetTimeScale(){this.Vt.resetTimeScale()}fitContent(){this.Vt.fitContent()}logicalToCoordinate(t){const i=this.Vt.timeScale();return i.isEmpty()?null:i.indexToCoordinate(t)}coordinateToLogical(t){return this.gh.isEmpty()?null:this.gh.coordinateToIndex(t)}timeToCoordinate(t){const i=ae(t),s=this.gh.timeToIndex(i,!1);return null===s?null:this.gh.indexToCoordinate(s)}coordinateToTime(t){var i;const s=this.Vt.timeScale(),e=s.coordinateToIndex(t),n=s.indexToTime(e);return null===n?null:null!==(i=n.businessDay)&&void 0!==i?i:n.timestamp}width(){return this.Uc.qu().tt}height(){return this.Uc.qu().it}subscribeVisibleTimeRangeChange(t){this.J_.subscribe(t)}unsubscribeVisibleTimeRangeChange(t){this.J_.unsubscribe(t)}subscribeVisibleLogicalRangeChange(t){this.cr.subscribe(t)}unsubscribeVisibleLogicalRangeChange(t){this.cr.unsubscribe(t)}subscribeSizeChange(t){this.mc.subscribe(t)}unsubscribeSizeChange(t){this.mc.unsubscribe(t)}applyOptions(t){this.gh.applyOptions(t)}options(){return y(this.gh.options())}Q_(){this.J_.p()&&this.J_._(this.getVisibleRange())}td(){this.cr.p()&&this.cr._(this.getVisibleLogicalRange())}sd(t){this.mc._(t.tt,t.it)}}function Ne(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function Ve(t){return function(t){if(S(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;S(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),S(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}const i=t.handleScroll;S(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Fe{constructor(t,i){this.ed=new pe,this.nd=new Map,this.hd=new Map,this.rd=new m,this.ld=new m,this.ad=new m;const s=void 0===i?y(ke):g(y(ke),Ve(i));this.U_=new qs(t,s),this.U_.ju().subscribe((t=>{this.rd.p()&&this.rd._(this.od(t()))}),this),this.U_.t_().subscribe((t=>{this.ld.p()&&this.ld._(this.od(t()))}),this),this.U_.Gc().subscribe((t=>{this.ad.p()&&this.ad._(this.ud(t()))}),this);const e=this.U_.Mo();this._d=new Ie(e,this.U_.Kc())}remove(){this.U_.ju().unsubscribeAll(this),this.U_.t_().unsubscribeAll(this),this._d.destroy(),this.U_.destroy(),this.nd.clear(),this.hd.clear(),this.rd.v(),this.ld.v(),this.ed.v()}resize(t,i,s){this.U_.qc(t,i,s)}addAreaSeries(t){return this.dd("Area",Pe,t)}addBaselineSeries(t){return this.dd("Baseline",De,t)}addBarSeries(t){return this.dd("Bar",xe,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.dd("Candlestick",Ce,t)}addHistogramSeries(t){return this.dd("Histogram",Le,t)}addLineSeries(t){return this.dd("Line",Te,t)}removeSeries(t){const i=h(this.nd.get(t)),s=this.ed.O_(i);this.U_.Mo().removeSeries(i),this.fd(s),this.nd.delete(t),this.hd.delete(i)}K_(t,i){this.fd(this.ed.D_(t,i))}G_(t,i){this.fd(this.ed.B_(t,i))}subscribeClick(t){this.rd.subscribe(t)}unsubscribeClick(t){this.rd.unsubscribe(t)}subscribeCrosshairMove(t){this.ld.subscribe(t)}unsubscribeCrosshairMove(t){this.ld.unsubscribe(t)}subscribeCustomPriceLineDragged(t){this.ad.subscribe(t)}unsubscribeCustomPriceLineDragged(t){this.ad.unsubscribe(t)}priceScale(t){return new Ee(this.U_,t)}timeScale(){return this._d}applyOptions(t){this.U_.Qc(Ve(t))}options(){return this.U_.hu()}takeScreenshot(){return this.U_.i_()}setCrossHairXY(t,i,s){this.U_.Zc()[0].nc(t,i,s)}rc(){this.U_.Zc()[0].rc()}ud(t){return{customPriceLine:t.g_,fromPriceString:t.b_}}dd(t,i,s={}){Ne(s.priceFormat);const e=g(y(Re),y(i),s),n=this.U_.Mo().createSeries(t,e),h=new Be(n,this,this);return this.nd.set(h,n),this.hd.set(n,h),h}fd(t){const i=this.U_.Mo();i.updateTimeScale(t.F_.W_,t.F_.j_,t.F_.H_),t.V_.forEach(((t,i)=>i.setData(t.zs,t.z_))),i.recalculateAllPanes()}pd(t){return h(this.hd.get(t))}od(t){const i=new Map;t.f_.forEach(((t,s)=>{const e=Me(s.seriesType())(t);n(function(t){return void 0!==t.open||void 0!==t.value}(e)),i.set(this.pd(s),e)}));const s=void 0===t.d_?void 0:this.pd(t.d_);return{time:t.Ft,logical:t.Yh,point:t.__,hoveredSeries:s,hoveredObjectId:t.p_,seriesData:i,sourceEvent:t.v_}}}var We=Object.freeze({__proto__:null,version:function(){return"4.0.0-dev+202212081626"},get LineStyle(){return i},get LineType(){return t},get TrackingModeExitMode(){return ns},get CrosshairMode(){return G},get MismatchDirection(){return bi},get PriceScaleMode(){return zi},get PriceLineSource(){return rs},get LastPriceAnimationMode(){return hs},get TickMarkType(){return es},get ColorType(){return ls},isBusinessDay:ds,isUTCTimestamp:fs,createChart:function(t,i){let s;if(M(t)){const i=document.getElementById(t);n(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Fe(s,i)}});window.LightweightCharts=We}();
